<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>XMail mail server v 1.21</title>
<link rel="stylesheet" href="./xmail.css" type="text/css" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#license">LICENSE</a></li>
	<li><a href="#overview">OVERVIEW</a></li>
	<li><a href="#version">VERSION</a></li>
	<ul>

		<li><a href="#current">current</a></li>
		<li><a href="#release_type">release type</a></li>
		<li><a href="#release_date">release date</a></li>
		<li><a href="#project_by">project by</a></li>
		<li><a href="#credits">credits</a></li>
		<li><a href="#warning">warning</a></li>
	</ul>

	<li><a href="#documentation_conventions">DOCUMENTATION CONVENTIONS</a></li>
	<li><a href="#features">FEATURES</a></li>
	<li><a href="#porting_status">PORTING STATUS</a></li>
	<li><a href="#requirements">REQUIREMENTS</a></li>
	<li><a href="#obtaining_the_source">OBTAINING THE SOURCE</a></li>
	<li><a href="#build">BUILD</a></li>
	<li><a href="#configuration">CONFIGURATION</a></li>
	<ul>

		<li><a href="#linux_solaris_freebsd_openbsd">Linux/Solaris/FreeBSD/OpenBSD</a></li>
		<li><a href="#nt_win2k">NT/Win2K</a></li>
		<li><a href="#environment_variables">Environment variables</a></li>
		<li><a href="#mailroot_structure">MailRoot structure</a></li>
		<li><a href="#configuration_tables">Configuration tables</a></li>
		<ul>

			<li><a href="#aliases_tab">ALIASES.TAB</a></li>
			<li><a href="#aliasdomain_tab">ALIASDOMAIN.TAB</a></li>
			<li><a href="#domains_tab">DOMAINS.TAB</a></li>
			<li><a href="#dnsroots">DNSROOTS</a></li>
			<li><a href="#extaliases_tab">EXTALIASES.TAB</a></li>
			<li><a href="#mailusers_tab">MAILUSERS.TAB</a></li>
			<li><a href="#message_id">MESSAGE.ID</a></li>
			<li><a href="#pop3links_tab">POP3LINKS.TAB</a></li>
			<li><a href="#server_tab">SERVER.TAB</a></li>
			<li><a href="#smtpgw_tab">SMTPGW.TAB</a></li>
			<li><a href="#smtpfwd_tab">SMTPFWD.TAB</a></li>
			<li><a href="#smtprelay_tab">SMTPRELAY.TAB</a></li>
			<li><a href="#smtpauth_tab">SMTPAUTH.TAB</a></li>
			<li><a href="#smtpextauth_tab">SMTPEXTAUTH.TAB</a></li>
			<li><a href="#userdef_tab">USERDEF.TAB</a></li>
			<li><a href="#ctrlaccounts_tab">CTRLACCOUNTS.TAB</a></li>
			<li><a href="#spammers_tab">SPAMMERS.TAB</a></li>
			<li><a href="#spamaddress_tab">SPAM-ADDRESS.TAB</a></li>
			<li><a href="#pop3_ipmap_tab">POP3.IPMAP.TAB</a></li>
			<li><a href="#smtp_ipmap_tab">SMTP.IPMAP.TAB</a></li>
			<li><a href="#ctrl_ipmap_tab">CTRL.IPMAP.TAB</a></li>
			<li><a href="#finger_ipmap_tab">FINGER.IPMAP.TAB</a></li>
			<li><a href="#user_tab">USER.TAB</a></li>
			<li><a href="#mlusers_tab">MLUSERS.TAB</a></li>
			<li><a href="#mailproc_tab">MAILPROC.TAB</a></li>
			<li><a href="#smtp_ipprop_tab">SMTP.IPPROP.TAB</a></li>
			<li><a href="#filters_in_tab">FILTERS.IN.TAB</a></li>
			<li><a href="#filters_out_tab">FILTERS.OUT.TAB</a></li>
			<li><a href="#filters_predata_tab">FILTERS.PRE-DATA.TAB</a></li>
			<li><a href="#filters_postdata_tab">FILTERS.POST-DATA.TAB</a></li>
		</ul>

	</ul>

	<li><a href="#external_authentication">EXTERNAL AUTHENTICATION</a></li>
	<li><a href="#smtp_client_authentication">SMTP CLIENT AUTHENTICATION</a></li>
	<li><a href="#custom_domain_mail_processing">CUSTOM DOMAIN MAIL PROCESSING</a></li>
	<li><a href="#cmd_aliases">CMD ALIASES</a></li>
	<li><a href="#server_tab_variables">SERVER.TAB VARIABLES</a></li>
	<li><a href="#message_filters">MESSAGE FILTERS</a></li>
	<li><a href="#smtp_message_filters">SMTP MESSAGE FILTERS</a></li>
	<li><a href="#user_tab_variables">USER.TAB VARIABLES</a></li>
	<li><a href="#mail_routing_through_addresses">MAIL ROUTING THROUGH ADDRESSES</a></li>
	<li><a href="#xmail_spool_design">XMAIL SPOOL DESIGN</a></li>
	<li><a href="#smtp_commands">SMTP COMMANDS</a></li>
	<li><a href="#pop3_commands">POP3 COMMANDS</a></li>
	<li><a href="#command_line">COMMAND LINE</a></li>
	<li><a href="#xmail_admin_protocol">XMAIL ADMIN PROTOCOL</a></li>
	<ul>

		<li><a href="#description">Description</a></li>
		<li><a href="#adding_a_user">Adding a user</a></li>
		<li><a href="#deleting_a_user">Deleting a user</a></li>
		<li><a href="#changing_a_user_s_password">Changing a user's password</a></li>
		<li><a href="#authenticate_user">Authenticate user</a></li>
		<li><a href="#retrieve_user_statistics">Retrieve user statistics</a></li>
		<li><a href="#adding_an_alias">Adding an alias</a></li>
		<li><a href="#deleting_an_alias">Deleting an alias</a></li>
		<li><a href="#listing_aliases">Listing aliases</a></li>
		<li><a href="#adding_an_external_alias">Adding an external alias</a></li>
		<li><a href="#deleting_an_external_alias">Deleting an external alias</a></li>
		<li><a href="#listing_external_aliases">Listing external aliases</a></li>
		<li><a href="#listing_user_vars">Listing user vars</a></li>
		<li><a href="#setting_user_vars">Setting user vars</a></li>
		<li><a href="#listing_users">Listing users</a></li>
		<li><a href="#getting_mailproc_tab_file">Getting mailproc.tab file</a></li>
		<li><a href="#setting_mailproc_tab_file">Setting mailproc.tab file</a></li>
		<li><a href="#adding_a_mailing_list_user">Adding a mailing list user</a></li>
		<li><a href="#deleting_a_mailing_list_user">Deleting a mailing list user</a></li>
		<li><a href="#listing_mailing_list_users">Listing mailing list users</a></li>
		<li><a href="#adding_a_domain">Adding a domain</a></li>
		<li><a href="#deleting_a_domain">Deleting a domain</a></li>
		<li><a href="#listing_handled_domains">Listing handled domains</a></li>
		<li><a href="#adding_a_domain_alias">Adding a domain alias</a></li>
		<li><a href="#deleting_a_domain_alias">Deleting a domain alias</a></li>
		<li><a href="#listing_alias_domains">Listing alias domains</a></li>
		<li><a href="#getting_custom_domain_file">Getting custom domain file</a></li>
		<li><a href="#setting_custom_domain_file">Setting custom domain file</a></li>
		<li><a href="#listing_custom_domains">Listing custom domains</a></li>
		<li><a href="#adding_a_pop3_external_link">Adding a POP3 external link</a></li>
		<li><a href="#deleting_a_pop3_external_link">Deleting a POP3 external link</a></li>
		<li><a href="#listing_pop3_external_links">Listing POP3 external links</a></li>
		<li><a href="#enabling_a_pop3_external_link">Enabling a POP3 external link</a></li>
		<li><a href="#listing_files">Listing files</a></li>
		<li><a href="#getting_configuration_file">Getting configuration file</a></li>
		<li><a href="#setting_configuration_file">Setting configuration file</a></li>
		<li><a href="#listing_frozen_messages">Listing frozen messages</a></li>
		<li><a href="#rescheduling_frozen_message">Rescheduling frozen message</a></li>
		<li><a href="#deleting_frozen_message">Deleting frozen message</a></li>
		<li><a href="#getting_frozen_message_log_file">Getting frozen message log file</a></li>
		<li><a href="#getting_frozen_message">Getting frozen message</a></li>
		<li><a href="#starting_a_queue_flush">Starting a queue flush</a></li>
		<li><a href="#do_nothing_command">Do nothing command</a></li>
		<li><a href="#quit_the_connection">Quit the connection</a></li>
		<li><a href="#do_you_want___">Do you want...?</a></li>
	</ul>

	<li><a href="#xmail_local_mailer">XMAIL LOCAL MAILER</a></li>
	<li><a href="#ctrlclnt__xmail_administration_">CtrlClnt (XMAIL ADMINISTRATION)</a></li>
	<li><a href="#server_shutdown">SERVER SHUTDOWN</a></li>
	<li><a href="#mkusers">MkUsers</a></li>
	<li><a href="#sendmail">sendmail</a></li>
	<li><a href="#miscellaneous">MISCELLANEOUS</a></li>
	<li><a href="#known_bugs">KNOWN BUGS</a></li>
	<li><a href="#thanks">THANKS</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>XMail - Internet/Intranet mail server.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="license">LICENSE</a></h1>
<p>This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation (<a href="http://www.gnu.org">http://www.gnu.org</a>);
either version 2 of the License, or
(at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>
<p>you should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="overview">OVERVIEW</a></h1>
<p>XMail is an Internet and Intranet mail server featuring an SMTP server,
POP3 server, finger server, multiple domains,
no need for users to have a real system account,
SMTP relay checking, RBL/RSS/ORBS/DUL and custom (IP based and address based) spam protection,
SMTP authentication (PLAIN LOGIN CRAM-MD5 POP3-before-SMTP and custom),
a POP3 account synchronizer with external POP3 accounts, account aliases,
domain aliases, custom mail processing, direct mail files delivery,
custom mail filters, mailing lists, remote administration, custom mail exchangers,
logging, and multi-platform code.</p>
<p>XMail sources compile under GNU/Linux, FreeBSD, OpenBSD, NetBSD, OSX, Solaris and NT/2K.</p>
<p>This server born due to the need of having a free and stable Mail Server
to be used inside my old company, which used a Windows Network.
I don't like to reinvent the wheel but the need of some special features
drive me to start a new project. Probably if I could use a Linux server
on my net, I would be able to satisfy my needs without write code, but
this is not my case. It should be also portable to other OSs, like Linux
and other Unixes.</p>
<p>Another reason that drove me to write XMail is the presence of the same steps
in setting up a typical mail server, ie:</p>
<pre>
 sendmail + qpopper + fetchmail</pre>
<p>if one needs SMTP, POP3 and external synchronization, or:</p>
<pre>
 sendmail + qpopper</pre>
<p>for only SMTP and POP3 (I've quoted sendmail, qpopper and fetchmail, but there
are many other packages you can use to reach these needs).
With XMail you get an all-in-one package with a central administration that can
simplify the above common steps.</p>
<p>The first code of XMail Server is started on Windows NT and Linux, and
now, the FreeBSD and Solaris version ready. The compilers supported are gcc for
Linux, FreeBSD, OpenBSD and Solaris and M$ Visual C++ for NT/2K.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>
</p>
<h2><a name="current">current</a></h2>
<p>1.21</p>
<p>
</p>
<h2><a name="release_type">release type</a></h2>
<p>Gnu Public License <a href="http://www.gnu.org">http://www.gnu.org</a></p>
<p>
</p>
<h2><a name="release_date">release date</a></h2>
<p>Jan 9, 2005</p>
<p>
</p>
<h2><a name="project_by">project by</a></h2>
<p>Davide Libenzi &lt;<a href="mailto:davidel@xmailserver.org">davidel@xmailserver.org</a>&gt; <a href="http://www.xmailserver.org/">http://www.xmailserver.org/</a></p>
<p>
</p>
<h2><a name="credits">credits</a></h2>
<p>Michael Hartle &lt;<a href="mailto:mhartle@hartle-klug.com">mhartle@hartle-klug.com</a>&gt;</p>
<p>Shawn Anderson &lt;<a href="mailto:sanderson@eye-catcher.com">sanderson@eye-catcher.com</a>&gt;</p>
<p>Dick van der Kaaden &lt;<a href="mailto:dick@netrex.nl">dick@netrex.nl</a>&gt;</p>
<p>Beau E, Cox &lt;<a href="mailto:beau@beaucox.com">beau@beaucox.com</a>&gt;</p>
<p>
</p>
<h2><a name="warning">warning</a></h2>
<pre>
 ************************************************************
 *                     &lt;&lt;WARNING&gt;&gt;                          *
 *  If you're upgrading an existing version of XMail it's   *
 *  strongly suggested that you read all the ChangeLog.txt  *
 *  notes that range from existing version to the new one.  *
 ************************************************************</pre>
<p>See the <a href="./ChangeLog.html"><b>Change Log</b></a>.</p><p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="documentation_conventions">DOCUMENTATION CONVENTIONS</a></h1>
<p>This document contains various examples of entries you must make to the XMail
configuration tables. These examples are written in a</p>
<pre>
 mono-spaced font like this.</pre>
<p>The prototype statement is shown with explicit '<strong>[TAB]</strong>' and '<strong>[NEWLINE]</strong>'
characters:</p>
<pre>
 &quot;aliasdomain&quot;[TAB]&quot;realdomain&quot;[NEWLINE]</pre>
<p>while examples omit these characters:</p>
<pre>
 &quot;simpson.org&quot;   &quot;simpson.com&quot;
 &quot;*.homer.net&quot;   &quot;homer.net&quot;</pre>
<p>'<strong>YOU MUST ALWAYS ENTER THE DATA EXACTLY AS SHOWN IN THE PROTOTYPE.</strong>'</p>
<p>When a protype or example statement is too long to easily be shown on the screen or
printed, the line is split into multiple lines by showing '<strong>=</strong>&gt;' at the end of
continued lines and indenting the continuation line(s):</p>
<pre>
 &quot;domain&quot;[TAB]&quot;account&quot;[TAB]&quot;enc-passwd&quot;[TAB]&quot;account-id&quot;[TAB]&quot;account-dir&quot;[TAB]=&gt;
   &quot;account-type&quot;[NEWLINE]</pre>
<p>'<strong>DO NOT ENTER THE =&gt; CHARACTERS. ENTER THE ENTIRE ENTRY AS ONE LINE.</strong>'</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="features">FEATURES</a></h1>
<ul>
<li></li>
ESMTP server
<p></p>
<li></li>
POP3 server
<p></p>
<li></li>
Finger server
<p></p>
<li></li>
Multiple domains
<p></p>
<li></li>
Users don't need a real system account
<p></p>
<li></li>
SMTP relay checking
<p></p>
<li></li>
SMTP RBL maps check (rbl.maps.vix.com)
<p></p>
<li></li>
SMTP RSS maps check (relays.mail-abuse.org)
<p></p>
<li></li>
SMTP ORBS relay check (relays.orbs.org)
<p></p>
<li></li>
SMTP DUL map check (dialups.mail-abuse.org)
<p></p>
<li></li>
SMTP protection over spammers (IP based and address based)
<p></p>
<li></li>
SMTP authentication (PLAIN LOGIN CRAM-MD5 POP3/SMTP and custom)
<p></p>
<li></li>
SMTP ETRN command support
<p></p>
<li></li>
POP3 account synchronizer with external POP3 accounts
<p></p>
<li></li>
Account aliasing
<p></p>
<li></li>
Domain aliasing
<p></p>
<li></li>
Mailing lists
<p></p>
<li></li>
Custom mail processing
<p></p>
<li></li>
Locally generated mail files delivery
<p></p>
<li></li>
Remote administration
<p></p>
<li></li>
Custom mail exchangers
<p></p>
<li></li>
Logging
<p></p>
<li></li>
Multi platform
<p></p>
<li></li>
Domain message filters
<p></p>
<li></li>
Custom (external) POP3 authentication
<p></p></ul>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="porting_status">PORTING STATUS</a></h1>
<p>Right now the Linux and NT ports are stable, while the Solaris, FreeBSD and OpenBSD
ones have not been tested as well as the previous OSs.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="requirements">REQUIREMENTS</a></h1>
<ul>
<li></li>
Any version of Linux that has glibc.
<p></p>
<li></li>
Windows NT with ws2_32.dll correctly installed.
<p></p>
<li></li>
A working DNS and gateway to the Internet (if you plan to use it).
<p></p>
<li></li>
To build from source for Linux you need any version of gcc and glibc installed.
<p></p>
<li></li>
To build from source for Windows you need MS Visual C++ (project included).
<p></p>
<li></li>
-or- any other working compiler that provides support for the Win32 SDK.
<p></p></ul>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="obtaining_the_source">OBTAINING THE SOURCE</a></h1>
<p>Always get the latest sources at the XMail home page <a href="http://www.xmailserver.org/">http://www.xmailserver.org/</a>
because otherwise you may be using an old version.</p>
<p>Use the correct distribution for your system and don't mix Unix files with
Windows ones because this is one of the most common cause of XMail bad behavior.</p>
<p>When you unzip (or untar) the package you've to check that the MailRoot
directory contained inside
the package itself is complete (look at the directory tree listed below) because
some unzippers don't restore empty directories.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="build">BUILD</a></h1>
<p>For Windows, Visual C++ project files are supplied, while for *nixes, the following
options are given:</p>
<p>[Linux]</p>
<pre>
  # make -f Makefile.lnx</pre>
<p>[FreeBSD]</p>
<pre>
  # setenv OSTYPE FreeBSD
  # gmake -f Makefile.bsd</pre>
<p>or (depending on the shell):</p>
<pre>
  # OSTYPE=FreeBSD gmake -f Makefile.bsd</pre>
<p>[OpenBSD]</p>
<pre>
  # setenv OSTYPE OpenBSD
  # gmake -f Makefile.bsd</pre>
<p>or (depending on the shell):</p>
<pre>
  # OSTYPE=OpenBSD gmake -f Makefile.bsd</pre>
<p>[NetBSD]</p>
<pre>
  # setenv OSTYPE NetBSD
  # gmake -f Makefile.bsd</pre>
<p>or (depending on the shell):</p>
<pre>
  # OSTYPE=NetBSD gmake -f Makefile.bsd</pre>
<p>[OSX]</p>
<pre>
  # OSTYPE=Darwin make -f Makefile.bsd</pre>
<p>or (depending on the shell):</p>
<pre>
  # setenv OSTYPE Darwin
  # make -f Makefile.bsd</pre>
<p>[Solaris]</p>
<pre>
  # make -f Makefile.sso</pre>
<p>Under Linux an init.d startup script is supplied (xmail) to allow you to run
XMail as a standard rc? daemon. You must put it into /etc/init.d (it depends on which
distro you're using) directory and then create K??xmail - S??xmail links into the
proper directories.</p>
<p>Under Windows NT/2000/XP the XMail's executable is a Win32 service by default and if
you want to have it built like a standard executable you've to comment the statement:</p>
<pre>
 &quot;#define SERVICE&quot; in MainWin.cpp</pre>
<p>When it's built as a service (default) you can run:</p>
<pre>
 XMail --install</pre>
<p>to install XMail as a manual startup service or:</p>
<pre>
 XMail --install-auto</pre>
<p>to install XMail as an automatic startup service.</p>
<p>If you run '<strong>--install</strong>' and you want XMail to run at NT boot, you must go in
ControlPanel-&gt;Services and edit the startup options of XMail.
Once you have the service version of XMail you can run it in a 'normal' way by
executing:</p>
<pre>
 XMail --debug [options]</pre>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="configuration">CONFIGURATION</a></h1>
<p>
</p>
<h2><a name="linux_solaris_freebsd_openbsd">Linux/Solaris/FreeBSD/OpenBSD</a></h2>
<ol>
<li></li>
Build XMail.
<p></p>
<li></li>
Log as root.
<p></p>
<li></li>
Copy the supplied MailRoot directory where you want it to reside (normally /var).
<p></p>
<li></li>
Do a
 # chmod 700 /var/MailRoot
to setup MailRoot directory access rights.
<p></p>
<li></li>
Strip XMail executables if you want to reduce their sizes (strip filename).
<p></p>
<li></li>
Copy XMail executables to  /var/MailRoot/bin.
<p></p>
<li></li>
If you have '<strong>inetd</strong>' installed, comment out the lines of '<strong>/etc/inetd.conf</strong>'
that involve SMTP, POP3, and Finger. Restart '<strong>inetd</strong>' (kill -HUP ...).
<p></p>
<li></li>
Since XMail use syslog to log messages, enable syslogd if it's not running.
<p></p>
<li></li>
Setup the '<strong>SERVER.TAB</strong>' configuration option (after reading the rest of this
document well).
<p></p>
<li></li>
Add your users and domains (after reading the rest of this
document well).
<p></p>
<li></li>
Change or comment out (#) the example account in '<strong>ctrlaccounts.tab</strong>' by using
non-trivial username and password.
<p></p>
<li></li>
Copy  the xmail startup script to your init.d directory
(it's position depends on your distro).
If you've setup XMail to work in a subdirectory other than '<strong>/var/MailRoot</strong>' you
must edit  xmail  startup script to customize its boot.
<p></p>
<li></li>
Use the '<strong>sysv_inst.sh</strong>' shell script (from root user) to create SysV boot script -
unless your distro has other tools to do this.
<p></p>
<li></li>
To start XMail without reboot you can run (from root):
 /etc/rc.d/init.d/xmail start
otherwise reboot your machine.
<p></p>
<li></li>
Setup the file '<strong>smtprelay.tab</strong>' if you want to extend mail relaying to IPs out
of the internet's private IP blocks (or you want to deny even those - that comes enabled by
default with XMail).
<p></p></ol>
<p>[<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="nt_win2k">NT/Win2K</a></h2>
<ol>
<li></li>
Build XMail.
<p></p>
<li></li>
Copy the supplied MailRoot directory where you want it to reside (normally '<strong>C:\MailRoot</strong>').
<p></p>
<li></li>
Setup the MailRoot directory (and subdirectories and file) permissions to allow access
only to System and Administrators. Doing this you can run XMail as a console startup only
if you're Administrator (service startup as System).
<p></p>
<li></li>
Copy XMail executables to '<strong>C:\MailRoot\bin</strong>'.
<p></p>
<li></li>
With '<strong>regedit</strong>', create '<strong>GNU</strong>' key inside '<strong>HKEY_LOCAL_MACHINE\SOFTWARE\</strong>' and then '<strong>XMail</strong>'
key inside '<strong>HKEY_LOCAL_MACHINE\SOFTWARE\GNU</strong>'.
<p></p>
<li></li>
Create a new string value named '<strong>MAIL_ROOT</strong>' inside '<strong>HKEY_LOCAL_MACHINE\SOFTWARE\GNU\XMail\</strong>'
with value '<strong>C:\MailRoot</strong>'.
<p></p>
<li></li>
Optionally create a new string value named '<strong>MAIL_CMD_LINE</strong>' inside
'<strong>HKEY_LOCAL_MACHINE\SOFTWARE\GNU\XMail\</strong>' to store your command line options
(read well the rest of this document).
<p></p>
<li></li>
Open an NT console (command prompt).
<p></p>
<li></li>
Go inside '<strong>C:\MailRoot\bin</strong>' and run:
 XMail --install
for a manual startup, or:
 XMail --install-auto
for an automatic startup.
<p></p>
<li></li>
If you have other services that give the same functionality of XMail, that is
SMTP, POP3, or Finger servers, you must stop these services.
<p></p>
<li></li>
Setup the '<strong>SERVER.TAB</strong>' configuration option after reading the rest of this document
well.
<p></p>
<li></li>
Add your users and domains (after reading to the rest of this document well).
<p></p>
<li></li>
Setup file permissions of the '<strong>C:\MailRoot</strong>' directory to grant access only to
'<strong>SYSTEM</strong>' and '<strong>Domain Admins</strong>'.
<p></p>
<li></li>
Change or comment out (#) the example account in  ctrlaccounts.tab  by using a
non-trivial username and password.
<p></p>
<li></li>
To start XMail without reboot you can go to:
 ControlPanel -&gt; Services -&gt; XMail server
and start the service, otherwise reboot your machine.
<p></p>
<li></li>
Setup the file '<strong>smtprelay.tab</strong>' if you want to extend mail relaying to IPs out
of the internet's private IP blocks (or you want to deny even those - that comes enabled by
default with XMail).
<p></p></ol>
<p>[<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="environment_variables">Environment variables</a></h2>
<dl>
<dt><strong><a name="item__5bmail_root_5d">[MAIL_ROOT]</a></strong><br />
</dt>
<dd>
If you want to start XMail as a simple test you must setup an environment variable 
MAIL_ROOT that point to the XMail Server root directory.
</dd>
<dd>
<p>Linux/etc.:</p>
</dd>
<dd>
<pre>
 export MAIL_ROOT=/var/XMailRoot</pre>
</dd>
<dd>
<p>Windows:</p>
</dd>
<dd>
<pre>
 set MAIL_ROOT=C:\MailRoot</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bmail_cmd_line_5d">[MAIL_CMD_LINE]</a></strong><br />
</dt>
<dd>
Let the user to specify extra command line parameters (they will be appended to the
ones specified in the command line).
</dd>
<p></p>
<dt><strong><a name="item__5bxmail_pid_dir_5d">[XMAIL_PID_DIR]</a></strong><br />
</dt>
<dd>
Let the user to specify the PID directory (Unix only ports). The specified directory must
NOT have the final slash (/) appended to the path.
</dd>
<p></p></dl>
<p>[<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="mailroot_structure">MailRoot structure</a></h2>
<p>Mail root directory contain these files:</p>
<pre>
  aliases.tab &lt;file&gt;
  aliasdomain.tab &lt;file&gt;
  domains.tab &lt;file&gt;
  dnsroots    &lt;file&gt;
  extaliases.tab  &lt;file&gt;
  mailusers.tab   &lt;file&gt;
  message.id  &lt;file&gt;
  pop3links.tab   &lt;file&gt;
  server.tab  &lt;file&gt;
  smtpgw.tab  &lt;file&gt;
  smtpfwd.tab &lt;file&gt;
  smtprelay.tab   &lt;file&gt;
  smtpauth.tab    &lt;file&gt;
  smtpextauth.tab &lt;file&gt;
  userdef.tab &lt;file&gt;
  ctrlaccounts.tab    &lt;file&gt;
  spammers.tab    &lt;file&gt;
  spam-address.tab    &lt;file&gt;
  pop3.ipmap.tab  &lt;file&gt;
  smtp.ipmap.tab  &lt;file&gt;
  ctrl.ipmap.tab  &lt;file&gt;
  finger.ipmap.tab    &lt;file&gt;
  filters.in.tab  &lt;file&gt;
  filters.out.tab &lt;file&gt;
  filters.pre-data.tab &lt;file&gt;
  filters.post-data.tab &lt;file&gt;
  smtp.ipprop.tab &lt;file&gt;</pre>
<p>and these directories:</p>
<pre>
  bin     &lt;dir&gt;
  cmdaliases  &lt;dir&gt;
  tabindex    &lt;dir&gt;
  dnscache    &lt;dir&gt;
    mx  &lt;dir&gt;
    ns  &lt;dir&gt;
  custdomains &lt;dir&gt;
  filters     &lt;dir&gt;
  logs        &lt;dir&gt;
  pop3locks   &lt;dir&gt;
  pop3linklocks   &lt;dir&gt;
  pop3links   &lt;dir&gt;
  spool       &lt;dir&gt;
    local       &lt;dir&gt;
    temp        &lt;dir&gt;
    0           &lt;dir&gt;
      0           &lt;dir&gt;
        mess        &lt;dir&gt;
        rsnd        &lt;dir&gt;
        info        &lt;dir&gt;
        temp        &lt;dir&gt;
        slog        &lt;dir&gt;
        lock        &lt;dir&gt;
        cust        &lt;dir&gt;
        froz        &lt;dir&gt;
      ...
    ...
  userauth    &lt;dir&gt;
    pop3    &lt;dir&gt;
    smtp    &lt;dir&gt;
  domains     &lt;dir&gt;</pre>
<p>and for each domain DOMAIN handled a directory (inside  domains):</p>
<pre>
    DOMAIN      &lt;dir&gt;
    userdef.tab &lt;file&gt;
    mailproc.tab    &lt;file&gt;  [ optional ]</pre>
<p>inside of which reside, for each account ACCOUNT:</p>
<pre>
      ACCOUNT         &lt;dir&gt;
        user.tab    &lt;file&gt;
        mlusers.tab &lt;file&gt;  [ mailing list case ]
        mailproc.tab    &lt;file&gt;  [ optional ]
        pop3.ipmap.tab  &lt;file&gt;  [ optional ]</pre>
<p>and</p>
<pre>
        mailbox     &lt;dir&gt;</pre>
<p>for mailbox structure, while:</p>
<pre>
        Maildir     &lt;dir&gt;
          tmp &lt;dir&gt;
          new &lt;dir&gt;
          cur &lt;dir&gt;</pre>
<p>for Maildir structure.</p>
<p>[<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="configuration_tables">Configuration tables</a></h2>
<p>TAB ('<strong>something.tab</strong>') files are text files (in the sense meant by the OS in use:
&lt;CR&gt;&lt;LF&gt; for NT and &lt;CR&gt; for Linux) with this format:</p>
<pre>
 &quot;value1&quot;[TAB]&quot;value2&quot;[TAB]...[NEWLINE]</pre>
<p>The following sections explain each file's structure and use.</p>
<dl>
<dt><strong><a name="item__22aliases_2etab_22"><a href="#aliases_tab">ALIASES.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22aliasdomain_2etab_22"><a href="#aliasdomain_tab">ALIASDOMAIN.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22domains_2etab_22"><a href="#domains_tab">DOMAINS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22dnsroots_22"><a href="#dnsroots">DNSROOTS</a></a></strong><br />
</dt>
<dt><strong><a name="item__22extaliases_2etab_22"><a href="#extaliases_tab">EXTALIASES.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22mailusers_2etab_22"><a href="#mailusers_tab">MAILUSERS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22message_2eid_22"><a href="#message_id">MESSAGE.ID</a></a></strong><br />
</dt>
<dt><strong><a name="item__22pop3links_2etab_22"><a href="#pop3links_tab">POP3LINKS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22server_2etab_22"><a href="#server_tab">SERVER.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtpgw_2etab_22"><a href="#smtpgw_tab">SMTPGW.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtpfwd_2etab_22"><a href="#smtpfwd_tab">SMTPFWD.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtprelay_2etab_22"><a href="#smtprelay_tab">SMTPRELAY.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtpauth_2etab_22"><a href="#smtpauth_tab">SMTPAUTH.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtpextauth_2etab_22"><a href="#smtpextauth_tab">SMTPEXTAUTH.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22userdef_2etab_22"><a href="#userdef_tab">USERDEF.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22ctrlaccounts_2etab_22"><a href="#ctrlaccounts_tab">CTRLACCOUNTS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22spammers_2etab_22"><a href="#spammers_tab">SPAMMERS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22spam_2daddress_2etab_22"><a href="#spamaddress_tab">SPAM-ADDRESS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22pop3_2eipmap_2etab_22"><a href="#pop3_ipmap_tab">POP3.IPMAP.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtp_2eipmap_2etab_22"><a href="#smtp_ipmap_tab">SMTP.IPMAP.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22ctrl_2eipmap_2etab_22"><a href="#ctrl_ipmap_tab">CTRL.IPMAP.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22finger_2eipmap_2etab_22"><a href="#finger_ipmap_tab">FINGER.IPMAP.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22user_2etab_22"><a href="#user_tab">USER.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22mlusers_2etab_22"><a href="#mlusers_tab">MLUSERS.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22mailproc_2etab_22"><a href="#mailproc_tab">MAILPROC.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22smtp_2eipprop_2etab_22"><a href="#smtp_ipprop_tab">SMTP.IPPROP.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22filters_2ein_2etab_22"><a href="#filters_in_tab">FILTERS.IN.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22filters_2eout_2etab_22"><a href="#filters_out_tab">FILTERS.OUT.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22filters_2epre_2ddata_2etab_22"><a href="#filters_predata_tab">FILTERS.PRE-DATA.TAB</a></a></strong><br />
</dt>
<dt><strong><a name="item__22filters_2epost_2ddata_2etab_22"><a href="#filters_postdata_tab">FILTERS.POST-DATA.TAB</a></a></strong><br />
</dt>
</dl>
<p>[<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="aliases_tab">ALIASES.TAB</a></h3>
<pre>
 &quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;realaccount&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;home.bogus&quot;    &quot;davidel&quot;   &quot;dlibenzi&quot;</pre>
<p>define 'davidel' as alias for 'dlibenzi' in 'home.bogus' domain.</p>
<pre>
 &quot;home.bogus&quot;    &quot;foo*bog&quot;   &quot;homer@internal-domain.org&quot;</pre>
<p>define an alias for all users whose name starts with '<strong>foo</strong>' and ends with '<strong>bog</strong>'
that point to the locally handled account '<strong>homer&#64;internal-domain.org</strong>'.</p>
<pre>
 &quot;home.bogus&quot;    &quot;??trips&quot;   &quot;travels&quot;</pre>
<p>define an alias for all users whose names start with any two chars and end with '<strong>trips</strong>'.
You can have widcard even in the domain field, as:
</p>
<pre>

 &quot;*&quot; &quot;postmaster&quot;    &quot;postmaster@domain.net&quot;</pre>
<p>You '<strong>CANNOT</strong>' edit this file while XMail is running because it is an indexed file.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="aliasdomain_tab">ALIASDOMAIN.TAB</a></h3>
<pre>
 &quot;aliasdomain&quot;[TAB]&quot;realdomain&quot;[NEWLINE]</pre>
<p>where '<strong>aliasdomain</strong>' can use wildcards:</p>
<pre>
 &quot;simpson.org&quot;   &quot;simpson.com&quot;
 &quot;*.homer.net&quot;   &quot;homer.net&quot;</pre>
<p>The first line defines '<strong>simpson.org</strong>' as an alias of '<strong>simpson.com</strong>' while the second remaps
all subdomains of '<strong>homer.net</strong>' to '<strong>homer.net</strong>'.</p>
<p>You '<strong>CANNOT</strong>' edit this file while XMail is running because it is an indexed file.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="domains_tab">DOMAINS.TAB</a></h3>
<pre>
 &quot;domain&quot;[NEWLINE]</pre>
<p>defines domains handled by the server.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="dnsroots">DNSROOTS</a></h3>
<pre>
 host</pre>
<p>This is a file that lists a root name server in each line (this is not a TAB file).
This can be created from a query via nslookup for type=ns and host = '.'.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="extaliases_tab">EXTALIASES.TAB</a></h3>
<pre>
 &quot;external-domain&quot;[TAB]&quot;external-account&quot;[TAB]&quot;local-domain&quot;[TAB]&quot;local-user&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;xmailserver.org&quot;   &quot;dlibenzi&quot;  &quot;home.bogus&quot;    &quot;dlibenzi&quot;</pre>
<p>This file is used in configurations in which the server does not run directly on Internet
(like my case) but acts as internal mail exchanger and external mail gateway.
This file defines 'Return-Path: &lt;...&gt;' mapping for internal mail delivery.
If you are using a Mail client like Outlook, Eudora, KMail ... you have to configure
your email address with the external account say 'dlibenzi&#64;xmailserver.org'.
When you post an internal message to 'foo&#64;home.bogus' the mail client puts your external
email address ('dlibenzi&#64;xmailserver.org') in the 'MAIL FROM: &lt;...&gt;' SMTP request.
Now if the user 'foo' replies to this message, it replies to 'dlibenzi&#64;xmailserver.org',
and then is sent to the external mail server.
With the entry above in '<strong>EXTALIASES.TAB</strong>' file the 'Return-Path: &lt;...&gt;' field is filled
with 'dlibenzi&#64;home.bogus' that leads to an internal mail reply.</p>
<p>You '<strong>CANNOT</strong>' edit this file while XMail is running because it is an indexed file.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="mailusers_tab">MAILUSERS.TAB</a></h3>
<pre>
 &quot;domain&quot;[TAB]&quot;account&quot;[TAB]&quot;enc-passwd&quot;[TAB]&quot;account-id&quot;[TAB]&quot;account-dir&quot;[TAB]=&gt;
   &quot;account-type&quot;[NEWLINE]</pre>
<p>(remember, enter as one line.) Example:</p>
<pre>
 &quot;home.bogus&quot;    &quot;dlibenzi&quot;  &quot;XYZ...&quot;    1   &quot;dlibenzi&quot;  &quot;U&quot;</pre>
<p>defines an account 'dlibenzi' in domain 'home.bogus' with the encrypted password 'XYZ...',
user id '1' and mail directory 'dlibenzi' inside '<strong>$MAIL_ROOT/domains/home.bogus</strong>'.
To allow multiple domain handling the POP3 client must use the entire email address
for the POP3 user account; for example. if a user has email user&#64;domain it must supply:</p>
<pre>
 user@domain</pre>
<p>as POP3 account login.</p>
<p>The directory 'account-dir' '<strong>must</strong>' case match with the field 'account-dir' of this file.
Note that user id '<strong>must</strong>' be unique for all users (duplicate user ids are not allowed).
The user id 0 is reserved by XMail and cannot be used.</p>
<p>The last field 'U' is the account type:</p>
<pre>
 &quot;U&quot; = User account
 &quot;M&quot; = Mailing list account</pre>
<p>The encrypted password is generated by '<strong>XMCrypt</strong>' whose source is '<strong>XMCrypt.cpp</strong>'.
Even if external authentication is used (see <a href="#external_authentication">External Authentication</a>) this
file '<strong>must</strong>' contain an entry for each user handled by XMail.</p>
<p>You '<strong>CANNOT</strong>' edit this file while XMail is running because it is an indexed file.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="message_id">MESSAGE.ID</a></h3>
<p>A file storing a sequential message number.
Set it at 1 when you install the server and leave it be handled by the software.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="pop3links_tab">POP3LINKS.TAB</a></h3>
<pre>
 &quot;local-domain&quot;[TAB]&quot;local-account&quot;[TAB]&quot;external-domain&quot;[TAB]=&gt;
   &quot;external-account&quot;[TAB]&quot;external-crypted-password&quot;[TAB]&quot;authtype&quot;[NEWLINE]</pre>
<p>(remember, enter as one line) where:</p>
<p>'<strong>authtype</strong>' = authentication method ('<strong>CLR</strong>' = USER/PASS auth,  '<strong>APOP</strong>' = APOP auth).</p>
<p>Examples;</p>
<pre>
 &quot;home.bogus&quot;    &quot;dlibenzi&quot;  &quot;xmailserver.org&quot;   &quot;dlibenzi&quot; &quot;XYZ...&quot;=&gt;
   &quot;APOP&quot;</pre>
<p>This entry is used to synchronize the external account 'dlibenzi&#64;xmailserver.org' with encrypted
password 'XYZ...' with the local account 'dlibenzi&#64;home.bogus' using '<strong>APOP</strong>' authentication.
It connect with the 'xmailserver.org' POP3 server and download all messages for 'dlibenzi&#64;xmailserver.org' into
the local account 'dlibenzi&#64;home.bogus'.
The remote server must support '<strong>APOP</strong>' authentication to specify '<strong>APOP</strong>' as authtype.
Even if using APOP authentication is more secure because clear usernames and password does not
travel on the network, if you're not sure about it, specify '<strong>CLR</strong>' as authtype.
For non local POP3 sync you've to specify a line like this one (&#64; as the first domain char):</p>
<pre>
 &quot;@home.bogus.com&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org:110&quot;   &quot;dlibenzi&quot; &quot;XYZ...&quot;=&gt;
   &quot;CLR&quot;</pre>
<p>This entry is used to synchronize the external account 'dlibenzi&#64;xmailserver.org' with encrypted
password 'XYZ...' with the account 'dlibenzi&#64;home.bogus.com' using '<strong>CLR</strong>' authentication.
The message is pushed into the spool having as destination  dlibenzi&#64;home.bogus.com  ,
so you've to have some kind of processing for that user or domain in your XMail configuration
(for example custom domain processing).
you can also have the option to setup a line like this one:</p>
<pre>
 &quot;?home.bogus.com,felins.net,pets.org&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org&quot;=&gt;
   &quot;dlibenzi&quot;  &quot;XYZ...&quot;    &quot;CLR&quot;</pre>
<p>and messages are dropped inside the spool by following these rules:</p>
<ol>
<li></li>
XMail parse the message headers by searching for To:, Cc: and Bcc: addresses.
<p></p>
<li></li>
Each address's domain is compared with the list of valid domains (felins.net, pets.org).
<p></p>
<li></li>
For each valid address the username part is taken and joined with the '&#64;' and
the masquerade domain name (the name following '?').
<p></p>
<li></li>
The message is spooled with the above built destination address.
<p></p></ol>
<p>Obviously the masquerade domain ('home.bogus.com') MUST be handled by the server or MUST be
a valid external mail domain.
So if a message having as To: address  graycat&#64;felins.net  is fetched by the previous line a
message is pushed into the spool with address  graycat&#64;home.bogus.com.
Particular attention is to be taken about at not creating mail loops.
Another option is:</p>
<pre>
 &quot;&amp;.local,felins.net,pets.org&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org&quot; &quot;dlibenzi&quot;=&gt;
   &quot;XYZ...&quot;    &quot;CLR&quot;</pre>
<p>where a fetched message whose To: address is graycat&#64;felins.net is replaced with
graycat&#64;felins.net.local.
You can avoid the matching domain list after the masquerading domain but, in that case,
you may have bad destination addresses inside the spool.
The list MUST be comma separated WITHOUT spaces.
XMail starts PSYNC session with a delay that you can specify with the -Yi nsec
command line parameter (default 120).
XMail also checks for the presence (inside MAIL_ROOT) of a file named '.psync-trigger' and,
when this file is found, a PSYNC session starts and that file is removed.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="server_tab">SERVER.TAB</a></h3>
<pre>
 &quot;varname&quot;[TAB]&quot;varvalue&quot;[NEWLINE]</pre>
<p>This file contains server configuration variables.
See <a href="#server_tab_variables">SERVER.TAB variables</a> below for details.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtpgw_tab">SMTPGW.TAB</a></h3>
<pre>
 &quot;domain&quot;[TAB]&quot;smtp-gateway&quot;[NEWLINE]</pre>
<p>Examples:</p>
<pre>
 &quot;foo.example.com&quot;   &quot;@xmailserver.org&quot;</pre>
<p>sends all mail for 'foo.example.com' through the 'xmailserver.org' SMTP server,
while:</p>
<pre>
 &quot;*.dummy.net&quot;   &quot;@relay.xmailserver.org&quot;</pre>
<p>sends all mail for  ``*'*.dummy.net'  through  'relay.xmailserver.org'.</p>
<p>The '<strong>smtp-gateway</strong>' can be a complex routing also, for example:</p>
<pre>
 &quot;*.dummy.net&quot;   &quot;@relay.xmailserver.org,@mail.nowhere.org&quot;</pre>
<p>sends all mail for  ``*'*.dummy.net'  through  '&#64;relay.xmailserver.org,&#64;mail.nowhere.org',
in this way:  relay.xmailserver.org --&gt; mail.nowhere.org --&gt; &#64;DESTINATION.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtpfwd_tab">SMTPFWD.TAB</a></h3>
<pre>
 &quot;domain&quot;[TAB]&quot;smtp-mx-list&quot;[NEWLINE]</pre>
<p>Examples:</p>
<pre>
 &quot;foo.example.com&quot;   &quot;mail.xmailserver.org:7001,192.168.1.1:6123,mx.xmailserver.org&quot;</pre>
<p>sends all mail for 'foo.example.com' using the provided list of mail exchangers,
while:</p>
<pre>
 &quot;*.dummy.net&quot;   &quot;mail.xmailserver.org,192.168.1.1,mx.xmailserver.org:6423&quot;</pre>
<p>sends all mail for  ``*'*.dummy.net'  through the provided list of mail exchangers.
If the port (:nn) is not specified the default SMTP port (25) is assumed.
you can also enable XMail to random-select the order of the gateway list by specifying:</p>
<pre>
 &quot;*.dummy.net&quot;   &quot;#mail.xmailserver.org,192.168.1.1,mx.xmailserver.org:6423&quot;</pre>
<p>using the character '<strong>#</strong>'  as the first char of the gateway list.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtprelay_tab">SMTPRELAY.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;212.131.173.0&quot;   &quot;255.255.255.0&quot;</pre>
<p>allows all hosts of the class 'C' network '212.131.173.XXX' to use the server as relay.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtpauth_tab">SMTPAUTH.TAB</a></h3>
<pre>
 &quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;permissions&quot;[NEWLINE]</pre>
<p>is used to permit SMTP clients authentication with protocols PLAIN, LOGIN, CRAM-MD5
and custom.
With custom authentication a file containing all secrets (username + ':' + password)
is passed as parameter to the custom authentication program which tests all secrets
to find the one matching (if exist).
For this reason it's better to keep the number of entries in this file as low as possible.
Permissions are a string that can contain:</p>
<dl>
<dt><strong><a name="item_m">M</a></strong><br />
</dt>
<dd>
open mailing features
</dd>
<p></p>
<dt><strong><a name="item_r">R</a></strong><br />
</dt>
<dd>
open relay features (bypass all other relay blocking traps)
</dd>
<p></p>
<dt><strong><a name="item_v">V</a></strong><br />
</dt>
<dd>
VRFY command enabled (bypass SERVER.TAB variable)
</dd>
<p></p>
<dt><strong><a name="item_t">T</a></strong><br />
</dt>
<dd>
ETRN command enabled (bypass SERVER.TAB variable)
</dd>
<p></p>
<dt><strong><a name="item_z">Z</a></strong><br />
</dt>
<dd>
disable mail size checking (bypass SERVER.TAB variable)
</dd>
<p></p></dl>
<p>When PLAIN, LOGIN or CRAM-MD5 authentication mode are used, first a lookup in '<strong>MAILUSERS.TAB</strong>'
accounts is performed to avoid duplicating information with '<strong>SMTPAUTH.TAB</strong>'.
Therefore when using these authentication modes a user must use as username the full email address
(the : separator is permitted instead of @) and as password his POP3 password.
If the lookup succeed the '<strong>SERVER.TAB</strong>' variable '<strong>DefaultSmtpPerms</strong>' is used to assign
user SMTP permissions (default MR).
If the lookup fails then '<strong>SMTPAUTH.TAB</strong>' lookup is done.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtpextauth_tab">SMTPEXTAUTH.TAB</a></h3>
<p>Besides internal SMTP authentication methods a user (XMail administrator) can define
custom authentication procedures by setting up this file properly.
The section <a href="#smtp_client_authentication">SMTP Client Authentication</a> explains the client part of custom
authentication when we put an '<strong>external</strong>' line inside the configuration file.
The file '<strong>SMTPEXTAUTH.TAB</strong>' is the server part of the custom authentication which has
the given format:</p>
<pre>
 &quot;auth-name&quot;[TAB]&quot;base-challenge&quot;[TAB]&quot;program-path&quot;[TAB]&quot;arg-or-macro&quot;...[NEWLINE]</pre>
<p>This file can contain multiple lines whose '<strong>auth-name</strong>' are listed during the
EHLO command response.
Where 'arg-or-macro' can be:</p>
<dl>
<dt><strong><a name="item__40_40chall">@@CHALL</a></strong><br />
</dt>
<dd>
server challenge given by  base-challenge + ':' + server-timestamp
</dd>
<p></p>
<dt><strong><a name="item__40_40dgest">@@DGEST</a></strong><br />
</dt>
<dd>
client response to server challenge (&#64;CHALL)
</dd>
<p></p>
<dt><strong><a name="item__40_40fsecrt">@@FSECRT</a></strong><br />
</dt>
<dd>
a file containing all the lines (username + ':' + password) of SMTPAUTH.TAB
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;RSA-AUTH&quot; &quot;foochallenge&quot; &quot;/usr/bin/myrsa-authenticate&quot;=&gt;
   &quot;-c&quot; &quot;@@CHALL&quot; &quot;-f&quot; &quot;@@FSECRT&quot; &quot;-d&quot; &quot;@@DGEST&quot;</pre>
<p>The external program must test all lines of '<strong>@@FSECRT</strong>' to find the one (if it exists)
that matches the client digest (<strong>@@DGEST</strong>).
If it finds a match, it must return zero and overwrite '<strong>@@FSECRT</strong>' with the matching secret
(username + ':' + password).
If a match is not found, the program must return a value other than zero.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="userdef_tab">USERDEF.TAB</a></h3>
<pre>
 &quot;varname&quot;[TAB]&quot;varvalue&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;RealName&quot;  &quot;??&quot;
 &quot;HomePage&quot;  &quot;??&quot;
 &quot;Address&quot;   &quot;??&quot;
 &quot;Telephone&quot; &quot;??&quot;
 &quot;MaxMBSize&quot; &quot;10000&quot;</pre>
<p>contains user default values for new users that are not set during the new account creation.
This file is looked up in two different places, first in '<strong>$MAIL_ROOT/domains/DOMAIN</strong>'
then in '<strong>$MAIL_ROOT</strong>',
where '<strong>DOMAIN</strong>' is the name of the domain where We're going to create the new user.</p>
<p>For each 'domain' handled by the server we'll create a directory 'domain' inside $MAIL_ROOT.
Inside $MAIL_ROOT/'domain' reside 'domain'-&gt;'account' directories
($MAIL_ROOT/'domain'/'account').
This folder contains a sub folder named '<strong>mailbox</strong>' (or '<strong>Maildir/(tmp,new,cur)</strong>')
that stores all 'account' messages.
It also contains a file named '<strong>USER.TAB</strong>' that stores``account'' variabiles, example:</p>
<pre>
 &quot;RealName&quot;  &quot;Davide Libenzi&quot;
 &quot;HomePage&quot;  &quot;<a href="http://www.xmailserver.org/davide.html&quot">http://www.xmailserver.org/davide.html&quot</a>;
 &quot;MaxMBSize&quot; &quot;30000&quot;</pre>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="ctrlaccounts_tab">CTRLACCOUNTS.TAB</a></h3>
<pre>
 &quot;username&quot;[TAB]&quot;password&quot;[NEWLINE]</pre>
<p>This file contains the accounts that are enable to remote administer XMail.
The password is encrypted with  the '<strong>XMCrypt</strong>'  program supplied with the source distro.</p>
<p>'<strong>REMEMBER THAT THIS HOLDS ADMIN ACCOUNTS, SO PLEASE CHOOSE COMPLEX USERNAMES AND PASSWORDS AND
USE CTRL.IPMAP.TAB TO RESTRICT IP ACCESS!
REMEMBER TO REMOVE THE EXAMPLE ACCOUNT FROM THIS FILE!</strong>'</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="spammers_tab">SPAMMERS.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[NEWLINE]</pre>
<p>or:</p>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;params&quot;[NEWLINE]</pre>
<p>or:</p>
<pre>
 &quot;ipaddr/bits&quot;[NEWLINE]</pre>
<p>or:</p>
<pre>
 &quot;ipaddr/bits&quot;[TAB]&quot;params&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;
 &quot;212.131.173.0/24&quot;</pre>
<p>register all hosts of the class 'C' network '212.131.173.XXX' as spammers,
and block them the use of XMail SMTP server. If a match is found on one of those records,
XMail will reject the incoming SMTP connection at early stages. It is possible to specify
optional parameters to tell XMail which behaviour it should assume in case of match. An
example of such setup is:</p>
<pre>
 &quot;212.131.173.0/24&quot;  &quot;code=0&quot;</pre>
<p>In this case a code=0 tells XMail to flag the connection as possible spammer, but wait later
SMTP session stages to reject the connection itself. In this case an authenticated SMTP session
can override the SPAMMERS.TAB match. The optional ``params'' field lists parameters associated
with the record, separated by a comma:</p>
<pre>
 &quot;param1=value1,param2=value2,...,paramN=valueN&quot;</pre>
<p>Currently supported parameters are:</p>
<dl>
<dt><strong><a name="item_code">code</a></strong><br />
</dt>
<dd>
Specify the rejection code for the record. If the value is greater than zero, the connection
is rejected soon, and the remote SMTP client is disconnected. If the value is zero, the
connection is flagged as spammer but wait later stages for rejection, by allowing
authenticated SMTP connections to bypass the SPAMMERS.TAB match. If the value is less than zero,
XMail will insert an ``absolute value'' seconds delay between SMTP commands.
</dd>
<p></p></dl>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="spamaddress_tab">SPAM-ADDRESS.TAB</a></h3>
<pre>
 &quot;spam-address&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;*@rude.net&quot;
 &quot;*-admin@even.more.rude.net&quot;</pre>
<p>blocks mails coming from the entire domain '<strong>rude.net</strong>' and coming from all
addresses that end with '<strong>-admin&#64;'even.more.rude.net</strong>.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="pop3_ipmap_tab">POP3.IPMAP.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</pre>
<p>This file controls the global IP access permission to the POP3 server if located
in the MAIL_ROOT path, and user IP access to its POP3 mailbox if located inside
the user directory.</p>
<p>Example:</p>
<pre>
 &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</pre>
<p>This configuration denies access to all IPs except the ones of the
class 'C' network '212.131.173.XXX'.</p>
<p>Higher precedences win over lower ones.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtp_ipmap_tab">SMTP.IPMAP.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</pre>
<p>This file controls IP access permission to SMTP server.</p>
<p>Example:</p>
<pre>
 &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</pre>
<p>This configuration denies access to all IPs except the ones of the
class 'C' network '212.131.173.XXX'.</p>
<p>Higher precedences win over lower ones.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="ctrl_ipmap_tab">CTRL.IPMAP.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</pre>
<p>This file control IP access permission to CTRL server.
Example:</p>
<pre>
 &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</pre>
<p>This configuration deny access to all IPs except the ones of the
class 'C' network '212.131.173.XXX'.
Higher precedences win over lower ones.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="finger_ipmap_tab">FINGER.IPMAP.TAB</a></h3>
<pre>
 &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</pre>
<p>This file controls IP access permission to FINGER server.
Example:</p>
<pre>
 &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</pre>
<p>This configuration denies access to all IPs except the ones of the
class 'C' network '212.131.173.XXX'.
Higher precedences win over lower ones.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="user_tab">USER.TAB</a></h3>
<pre>
 &quot;variable&quot;[TAB]&quot;value&quot;[NEWLINE]</pre>
<p>store user information such as:</p>
<pre>
 &quot;RealName&quot;  &quot;Davide Libenzi&quot;
 &quot;HomePage&quot;  &quot;<a href="http://www.xmailserver.org/davide.html&quot">http://www.xmailserver.org/davide.html&quot</a>;
 &quot;MaxMBSize&quot; &quot;30000&quot;
 &quot;ClosedML&quot;  &quot;0&quot;</pre>
<p>Please refer to <a href="#user_tab_variables">USER.TAB variables</a> below.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="mlusers_tab">MLUSERS.TAB</a></h3>
<p>If the user is a mailing list this file must exist inside the user account subdirectory
and contain a list of users subscribed to this list. The file format is:</p>
<pre>
 &quot;user&quot;[TAB]&quot;perms&quot;[NEWLINE]</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_user">user</a></strong><br />
</dt>
<dd>
subscriber email address.
</dd>
<p></p>
<dt><strong><a name="item_perms">perms</a></strong><br />
</dt>
<dd>
subscriber permissions:
</dd>
<dl>
<dt><strong>R</strong><br />
</dt>
<dd>
read.
</dd>
<p></p>
<dt><strong><a name="item_w">W</a></strong><br />
</dt>
<dd>
write (check done using the 'MAIL FROM:&lt;...&gt;' SMTP return path).
</dd>
<p></p>
<dt><strong><a name="item_a">A</a></strong><br />
</dt>
<dd>
write (check done using the email address used for SMTP authentication).
</dd>
<p></p></dl>
</dl>
<p>Example:</p>
<pre>
 &quot;davidel@xmailserver.org&quot;   &quot;RW&quot;
 &quot;ghostuser@nightmare.net&quot;   &quot;R&quot;
 &quot;meawmeaw@kitty.cat&quot;        &quot;RA&quot;</pre>
<p>If the '<strong>USER.TAB</strong>' file defines the '<strong>ClosedML</strong>' variable as '<strong>1</strong>' then a client can post
to this mailing list only if it's listed in '<strong>MLUSERS.TAB</strong>' with RW permissions.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="mailproc_tab">MAILPROC.TAB</a></h3>
<pre>
 &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>stores commands (internals or externals) that have to be executed on a message file.
The presence of this file is optional ans if it does not exist the default processing
is to store the message in user mailbox. The '<strong>MAILPROC.TAB</strong>' file can be either per
user or per domain, depending where the file is stored. If stored inside the user
directory it applies only to the user whose directory hosts the '<strong>MAILPROC.TAB</strong>', while
if stored inside the domain directory it applies to all users of such domain.
Each argument can be a macro also:</p>
<dl>
<dt><strong><a name="item__40_40from">@@FROM</a></strong><br />
</dt>
<dd>
is substituted for the sender of the message
</dd>
<p></p>
<dt><strong><a name="item__40_40rcpt">@@RCPT</a></strong><br />
</dt>
<dd>
is substituted for the recipient of the message
</dd>
<p></p>
<dt><strong><a name="item__40_40rrcpt">@@RRCPT</a></strong><br />
</dt>
<dd>
is substituted for the real recipient (@@RCPT could be an alias) of the message
</dd>
<p></p>
<dt><strong><a name="item__40_40file">@@FILE</a></strong><br />
</dt>
<dd>
is substituted for the message file path (the external command _must_ only read the file)
</dd>
<p></p>
<dt><strong><a name="item__40_40msgid">@@MSGID</a></strong><br />
</dt>
<dd>
is substituted for the (XMail unique) message id
</dd>
<p></p>
<dt><strong><a name="item__40_40msgref">@@MSGREF</a></strong><br />
</dt>
<dd>
is substituted for the reference SMTP message id
</dd>
<p></p>
<dt><strong><a name="item__40_40tmpfile">@@TMPFILE</a></strong><br />
</dt>
<dd>
creates a copy of the message file to a temporary one. It can be
used with 'external' command but in this case it's external program
responsibility to delete the temporary file. Do not use it with 'filter' commands
since the filter will have no way to modify the real spool file
</dd>
<p></p>
<dt><strong><a name="item__40_40userauth">@@USERAUTH</a></strong><br />
</dt>
<dd>
name of the SMTP authenticated user, or ``-'' if no authentication has been supplied
</dd>
<p></p></dl>
<p>Supported commands:</p>
<p>[EXTERNAL]</p>
<pre>
 &quot;external&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_external">external</a></strong><br />
</dt>
<dd>
command keyword
</dd>
<p></p>
<dt><strong><a name="item_priority">priority</a></strong><br />
</dt>
<dd>
process priority: 0 = normal  -1 = below normal  +1 = above normal
</dd>
<p></p>
<dt><strong><a name="item_wait_2dtimeout">wait-timeout</a></strong><br />
</dt>
<dd>
wait timeout for process execution in seconds: 0 = nowait
</dd>
<dd>
<p>Be carefull if using @@FILE to give the external command enough timeout to complete,
otherwise the file will be removed by XMail while the command is processing.
This is because such file is a temporary one that is deleted when XMail exits
from '<strong>MAILPROC.TAB</strong>' file processing. In case the external command exit code will
be '<strong>16</strong>', the command processing will stop and all the following commands listed inside
the file will be skipped.</p>
</dd>
<p></p></dl>
<p>[FILTER]</p>
<pre>
 &quot;filter&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_filter">filter</a></strong><br />
</dt>
<dd>
command keyword
</dd>
<p></p>
<dt><strong>priority</strong><br />
</dt>
<dd>
process priority: 0 = normal  -1 = below normal  +1 = above normal
</dd>
<p></p>
<dt><strong>wait-timeout</strong><br />
</dt>
<dd>
wait timeout for process execution in seconds: 0 = nowait
</dd>
<dd>
<p>With filters, it is not suggested to use @@TMPFILE, since the filter will never have
the ability to change the message content in that way. Also, to avoid problems very difficult to
troubleshoot, it is suggested to give the filter '<strong>ENOUGH</strong>' timeout to complete (90 seconds
or more). See [<a href="#message_filters">MESSAGE FILTERS</a>] for detailed information about return codes.
In the filter command, the ``Stop Filter Processing'' return flag will make XMail to stop
the execution of the current custom processing file.</p>
</dd>
<p></p></dl>
<p>The 'filter' command will pass the message file to a custom external filter, that
after inspecting it, has the option to accept, reject or modify it. Care should
be taken to properly re-format the message after changing it, to avoid message corruption.
The 'filter' command '<strong>CANNOT</strong>' successfully change the private XMail's header part of the
spool message.</p>
<p>[MAILBOX]</p>
<pre>
 &quot;mailbox&quot;[NEWLINE]</pre>
<p>With this command the message is pushed into local user mailbox.</p>
<p>[REDIRECT]</p>
<pre>
 &quot;redirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</pre>
<p>Redirect message to internal or external domain or email address.
If the message was for foo-user&#64;custdomain.net and the file custdomain.net.tab
contains a line:</p>
<pre>
 &quot;redirect&quot;  &quot;target-domain.org&quot;</pre>
<p>the message is delivered to '<strong>foo-user&#64;target-domain.org</strong>'.</p>
<p>While the line:</p>
<pre>
 &quot;redirect&quot;  &quot;user@target-domain.org&quot;</pre>
<p>redirects the message to user&#64;target-domain.org.</p>
<p>[LREDIRECT]</p>
<pre>
 &quot;lredirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</pre>
<p>Redirect the message to internal or external domain (or email address)
impersonating local domain during messages delivery.
If the message was for foo-user&#64;custdomain.net and the file custdomain.net.tab
contains a line:</p>
<pre>
 &quot;redirect&quot;  &quot;target-domain.org&quot;</pre>
<p>the message is delivered to '<strong>foo-user&#64;target-domain.org</strong>'.</p>
<p>While the line:</p>
<pre>
 &quot;redirect&quot;  &quot;user@target-domain.org&quot;</pre>
<p>redirects the message to '<strong>user&#64;target-domain.org</strong>'. The difference between
``redirect'' and ``lredirect'' is the following. Suppose A@B sends a message to C@D,
that has a redirect to E@F. With ``redirect'' E@F will see A@B has sender while with
``lredirect'' he will see C@D.</p>
<p>[SMTPRELAY]</p>
<pre>
 &quot;smtprelay&quot;[TAB]&quot;server[:port],server[:port],...&quot;[NEWLINE]</pre>
<p>Send mail to the specified SMTP server list by trying the first, if fails the second and so on.
Otherwise You can use this syntax:</p>
<pre>
 &quot;smtprelay&quot;[TAB]&quot;#server[:port],server[:port],...&quot;[NEWLINE]</pre>
<p>to have XMail random-select the order the specified relays.</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="smtp_ipprop_tab">SMTP.IPPROP.TAB</a></h3>
<pre>
 &quot;ip-addr&quot;[TAB]&quot;var0=value0&quot;...[TAB]&quot;varN=valueN&quot;[NEWLINE]</pre>
<p>Example:</p>
<pre>
 &quot;192.168.0.7/32&quot;   &quot;WhiteList=1&quot;</pre>
<p>Address selection mask are formed by an IP address (network) plus the number of
valid bits inside the network mask. No space are allowed between the variable name
and the '=' sign and between the '=' sign and the value. These are the currently
defined variables:</p>
<dl>
<dt><strong><a name="item_whitelist">WhiteList</a></strong><br />
</dt>
<dd>
If set to 1 and if the peer IP matches the address mask, all peer IP based checks will be skipped.
</dd>
<p></p></dl>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="filters_in_tab">FILTERS.IN.TAB</a></h3>
<p>See [<a href="#message_filters">MESSAGE FILTERS</a>]</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="filters_out_tab">FILTERS.OUT.TAB</a></h3>
<p>See [<a href="#message_filters">MESSAGE FILTERS</a>]</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="filters_predata_tab">FILTERS.PRE-DATA.TAB</a></h3>
<p>See [<a href="#smtp_message_filters">SMTP MESSAGE FILTERS</a>]</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h3><a name="filters_postdata_tab">FILTERS.POST-DATA.TAB</a></h3>
<p>See [<a href="#smtp_message_filters">SMTP MESSAGE FILTERS</a>]</p>
<p>[<a href="#configuration_tables">table index</a>] [<a href="#configuration">configuration</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="external_authentication">EXTERNAL AUTHENTICATION</a></h1>
<p>You can use external modules (executables) to perform user authentication instead
of using XMail  '<strong>mailusers.tab</strong>' lookups.
Inside  the userauth  directory you'll find one directory for each service whose
authentication can be handled externally (for now only POP3).
Suppose We must authenticate '<strong>USERNAME</strong>' inside '<strong>DOMAIN</strong>', XMail first tries
to lookup (inside  userauth/pop3) a file named:</p>
<p>'<strong>DOMAIN.tab</strong>'</p>
<p>else:</p>
<p>'<strong>.tab</strong>'</p>
<p>If one of these files is found, XMail authenticates '<strong>USERNAME</strong>' - '<strong>DOMAIN</strong>' using that file.
The authentication file is a TAB file (see at the proper section in this document) which has
the given structure:</p>
<pre>
 &quot;auth-action&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>Each argument can be a macro also:</p>
<dl>
<dt><strong><a name="item__40_40user">@@USER</a></strong><br />
</dt>
<dd>
the USERNAME to authenticate
</dd>
<p></p>
<dt><strong><a name="item__40_40domain">@@DOMAIN</a></strong><br />
</dt>
<dd>
the DOMAIN to authenticate
</dd>
<p></p>
<dt><strong><a name="item__40_40passwd">@@PASSWD</a></strong><br />
</dt>
<dd>
the user password
</dd>
<p></p>
<dt><strong><a name="item__40_40path">@@PATH</a></strong><br />
</dt>
<dd>
user path
</dd>
<p></p></dl>
<p>The values for '<strong>auth-action</strong>'  can be one of:</p>
<p>item userauth</p>
<p>executed when user authentication is required</p>
<dl>
<dt><strong><a name="item_useradd">useradd</a></strong><br />
</dt>
<dd>
executed when a user need to be added
</dd>
<p></p>
<dt><strong><a name="item_useredit">useredit</a></strong><br />
</dt>
<dd>
executed when a user change is required
</dd>
<p></p>
<dt><strong><a name="item_userdel">userdel</a></strong><br />
</dt>
<dd>
executed when a user deletion is required
</dd>
<p></p>
<dt><strong><a name="item_domaindrop">domaindrop</a></strong><br />
</dt>
<dd>
executed when all domain users need to be deleted
</dd>
<p></p></dl>
<p>The first line that stores the handling command for the requested action is executed as:</p>
<pre>
 command arg0 ... argN</pre>
<p>that must return zero if successful. Any other exit code is interpreted as
authentication operation failure, that. in '<strong>userauth</strong>' case, means such user is
not authenticated.</p>
<p>If the execution of the  command  fails for system reasons (command not found,
access denied, etc ...) then the user is not authenticated.</p>
<p>If none of this file's id are found, then usual authentication is performed ('<strong>mailusers.tab</strong>').
The use of external authentication does not avoid the presence of the user entry in
'<strong>mailusers.tab</strong>'.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="smtp_client_authentication">SMTP CLIENT AUTHENTICATION</a></h1>
<p>When a message is to be sent through an SMTP server that requires authentication,
XMail provides a way to handle this task by if the '<strong>userauth/smtp</strong>'
subdirectory is set up properly.</p>
<p>Suppose a mail is to be sent through the SMTP server '<strong>mail.foo.net</strong>', this makes XMail
to search for a file named (inside  userauth/smtp):</p>
<p>'<strong>mail.foo.net.tab</strong>'</p>
<p>then:</p>
<p>'<strong>foo.net.tab</strong>'</p>
<p>then:</p>
<p>'<strong>net.tab</strong>'</p>
<p>If one of these files is found its content is used to authenticate the SMTP client session.
The structure of this file, as the extension says, is the TAB one used for most of the
configuration files inside XMail.
Only the first valid line (uncommented #) is used to choose the authentication method
and lines has this format:</p>
<pre>
 &quot;auth-type&quot;[TAB]&quot;param1&quot;...[TAB]&quot;paramN&quot;[NEWLINE]</pre>
<p>Valid lines are:</p>
<pre>
 &quot;plain&quot; &quot;username&quot;  &quot;password&quot;</pre>
<p>or</p>
<pre>
 &quot;login&quot; &quot;username&quot;  &quot;password&quot;</pre>
<p>or</p>
<pre>
 &quot;cram-md5&quot;  &quot;username&quot;  &quot;password&quot;</pre>
<p>or</p>
<pre>
 &quot;external&quot;  &quot;auth-name&quot; &quot;secret&quot;    &quot;prog-path&quot; &quot;arg-or-macro&quot;  ...</pre>
<p>Where  '<strong>auth-name</strong>' can be any symbolic name and '<strong>arg-or-macro</strong>' can be a program
argument or one of these macros:</p>
<dl>
<dt><strong>@@CHALL</strong><br />
</dt>
<dd>
server challenge string
</dd>
<p></p>
<dt><strong><a name="item__40_40secrt">@@SECRT</a></strong><br />
</dt>
<dd>
authentication secret
</dd>
<p></p>
<dt><strong><a name="item__40_40rfile">@@RFILE</a></strong><br />
</dt>
<dd>
output response file path
</dd>
<p></p></dl>
<p>For example:</p>
<pre>
 &quot;external&quot; &quot;RSA-AUTH&quot; &quot;mysecret&quot; &quot;/usr/bin/myrsa-auth&quot; &quot;-c&quot; &quot;@@CHALL&quot; &quot;-s&quot;=&gt;
   &quot;@@SECRT&quot; &quot;-f&quot; &quot;@@RFILE&quot;</pre>
<p>XMail sends a line like:</p>
<pre>
 AUTH RSA-AUTH</pre>
<p>to the SMTP server, and wait for a line like:</p>
<pre>
 3?? base64-challenge</pre>
<p>Then XMail decodes '<strong>base64-challenge</strong>' and invokes the external program to get the response
to send to the SMTP server.
The external program must return zero upon success and must put the response into
the file  @@RFILE (without new line termination).</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="custom_domain_mail_processing">CUSTOM DOMAIN MAIL PROCESSING</a></h1>
<p>If a message that has as target domain of '<strong>sub1.sub2.domain.net</strong>' arrives at the XMail server,
'<strong>AND</strong>' XMail does not have a real domain '<strong>sub1.sub2.domain.net</strong>' inside its domain list,
XMail decides if this domain gets a custom domain processing by trying to lookup:</p>
<pre>
 sub1.sub2.domain.net.tab
 .sub2.domain.net.tab
 .domain.net.tab
 .net.tab
 .tab</pre>
<p>inside the '<strong>custdomains</strong>' directory.</p>
<p>If one of these files is found the incoming mail gets custom domain processing by executing
commands that are stored in such a file.</p>
<p>The format is:</p>
<pre>
 &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>These tables store commands (internals or externals) that have to be executed on the message file.
The presence of one of these files is optional and if none exist the default processing
is applied to the message via SMTP.</p>
<p>Each argument can be a macro also:</p>
<dl>
<dt><strong>@@FROM</strong><br />
</dt>
<dd>
the sender of the message
</dd>
<p></p>
<dt><strong>@@RCPT</strong><br />
</dt>
<dd>
the target of the message
</dd>
<p></p>
<dt><strong>@@FILE</strong><br />
</dt>
<dd>
the message file path (the external command '<strong>must only read</strong>' the file)
</dd>
<p></p>
<dt><strong>@@MSGID</strong><br />
</dt>
<dd>
the (XMail unique) message id
</dd>
<p></p>
<dt><strong>@@MSGREF</strong><br />
</dt>
<dd>
the reference SMTP message id
</dd>
<p></p>
<dt><strong>@@TMPFILE</strong><br />
</dt>
<dd>
creates a copy of the message file to a temporary one. It can be
used with 'external' command but in this case it's external program's
responsibility to delete the temporary file
</dd>
<p></p>
<dt><strong>@@USERAUTH</strong><br />
</dt>
<dd>
name of the SMTP authenticated user, or ``-'' if no authentication has been supplied
</dd>
<p></p></dl>
<p>Supported commands:</p>
<dl>
<dt><strong><a name="item__5bexternal_5d">[EXTERNAL]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;external&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
</dd>
<dd>
<p>where:</p>
</dd>
<dl>
<dt><strong>external</strong><br />
</dt>
<dd>
command keyword
</dd>
<p></p>
<dt><strong>priority</strong><br />
</dt>
<dd>
process priority: 0 = normal  -1 = below normal  +1 = above normal
</dd>
<p></p>
<dt><strong>wait-timeout</strong><br />
</dt>
<dd>
wait timeout for process execution in seconds: 0 = nowait
</dd>
<dd>
<p>Be carefull if using @@FILE to give the external command enough timeout to complete,
otherwise the file will be removed by XMail while the command is processing.
This is because such file is a temporary one that is deleted when XMail exits
from file processing. In case the external command exit code will be '<strong>16</strong>',
the command processing will stop and all the following commands listed inside
the file will be skipped.</p>
</dd>
<p></p></dl>
<dt><strong><a name="item__5bfilter_5d">[FILTER]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;filter&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
</dd>
<dd>
<p>where:</p>
</dd>
<dl>
<dt><strong>filter</strong><br />
</dt>
<dd>
command keyword
</dd>
<p></p>
<dt><strong>priority</strong><br />
</dt>
<dd>
process priority: 0 = normal  -1 = below normal  +1 = above normal
</dd>
<p></p>
<dt><strong>wait-timeout</strong><br />
</dt>
<dd>
wait timeout for process execution in seconds: 0 = nowait
</dd>
<dd>
<p>With filters, it is not suggested to use @@TMPFILE, since the filter will never have
the ability to change the message content in that way. Also, to avoid problems very difficult to
troubleshoot, it is suggested to give the filter '<strong>ENOUGH</strong>' timeout to complete (90 seconds
or more). See [<a href="#message_filters">MESSAGE FILTERS</a>] for detailed information about return codes.
In the filter command, the ``Stop Filter Processing'' return flag will make XMail to stop
the execution of the current custom processing file.</p>
</dd>
<p></p></dl>
<p>The 'filter' command will pass the message file to a custom external filter, that
after inspecting it, has the option to accept, reject or modify it. Care should
be taken to properly re-format the message after changing it, to avoid message corruption.
The 'filter' command '<strong>CANNOT</strong>' successfully change the private XMail's header part of the
spool message.</p>
<dt><strong><a name="item__5bredirect_5d">[REDIRECT]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;redirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</pre>
</dd>
<dd>
<p>Redirect message to internal or external domain or email address.
If the message was for foo-user&#64;custdomain.net and the file custdomain.net.tab
contains a line:</p>
</dd>
<dd>
<pre>
 &quot;redirect&quot;  &quot;target-domain.org&quot;</pre>
</dd>
<dd>
<p>the message is delivered to '<strong>foo-user&#64;target-domain.org</strong>'.</p>
</dd>
<dd>
<p>While the line:</p>
</dd>
<dd>
<pre>
 &quot;redirect&quot;  &quot;user@target-domain.org&quot;</pre>
</dd>
<dd>
<p>redirects the message to user&#64;target-domain.org.</p>
</dd>
<dt><strong><a name="item__5blredirect_5d">[LREDIRECT]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;lredirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</pre>
</dd>
<dd>
<p>Redirect the message to internal or external domain (or email address)
impersonating local domain during messages delivery.
If the message was for foo-user&#64;custdomain.net and the file custdomain.net.tab
contains a line:</p>
</dd>
<dd>
<pre>
 &quot;redirect&quot;  &quot;target-domain.org&quot;</pre>
</dd>
<dd>
<p>the message is delivered to '<strong>foo-user&#64;target-domain.org</strong>'.</p>
</dd>
<dd>
<p>While the line:</p>
</dd>
<dd>
<pre>
 &quot;redirect&quot;  &quot;user@target-domain.org&quot;</pre>
</dd>
<dd>
<p>redirects the message to '<strong>user&#64;target-domain.org</strong>'. The difference between
``redirect'' and ``lredirect'' is the following. Suppose A@B sends a message to C@D,
that has a redirect to E@F. With ``redirect'' E@F will see A@B has sender while with
``lredirect'' he will see C@D.</p>
</dd>
<dt><strong><a name="item__5bsmtprelay_5d">[SMTPRELAY]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;smtprelay&quot;[TAB]&quot;server[:port],server[:port],...&quot;[NEWLINE]</pre>
</dd>
<dd>
<p>Send mail to the specified SMTP server list by trying the first, if that fails, the second and so on.</p>
</dd>
<dd>
<p>Otherwise you can use this syntax:</p>
</dd>
<dd>
<pre>
 &quot;smtprelay&quot;[TAB]&quot;#server[:port],server[:port],...&quot;[NEWLINE]</pre>
</dd>
<dd>
<p>To have XMail random-select the order the specified relays.</p>
</dd>
<dt><strong><a name="item__5bsmtp_5d">[SMTP]</a></strong><br />
</dt>
<dd>
<pre>
 &quot;smtp&quot;[NEWLINE]</pre>
</dd>
<dd>
<p>Do SMTP delivery.</p>
</dd>
</dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="cmd_aliases">CMD ALIASES</a></h1>
<p>CmdAliases implement aliases that are handled only through commands and can be thought of as
a user level implementation of custom domain processing commands.
The command set is the same of the one that is described above
(<a href="#custom_domain_mail_processing">Custom domain mail processing</a>)
and won't be explained again here.</p>
<p>For every handled domain (listed inside '<strong>domains.tab</strong>') a directory with the same domain name
is created inside the '<strong>cmdaliases</strong>' subdirectory.
This directory is automatically created and removed when you add/remove domains through the
CTRL protocol (or '<strong>CtrlClnt</strong>').</p>
<p>When a mail for '<strong>USER&#64;DOMAIN</strong>' is received by the server, the domain '<strong>DOMAIN</strong>'
is to be
handled locally, and the standard users/aliases lookup fails, a file named '<strong>USER.tab</strong>' is searched
inside '<strong>$MAIL_ROOT/cmdaliases/DOMAIN</strong>'.
If such file is found, commands listed inside the file (whose format must follow the one
described in the previous section) are executed by the server as a matter of mail message processing.
An important thing to remember is that all domain and user names, when applied to the file
system, must be lower case.</p>
<p>The use of the command '<strong>[SMTP]</strong>' must be implemented with great care because it could create
mail loops within the server.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="server_tab_variables">SERVER.TAB VARIABLES</a></h1>
<p>The following variables are for use int the <a href="#server_tab">SERVER.TAB</a> configuration file.</p>
<dl>
<dt><strong><a name="item__5brootdomain_5d">[RootDomain]</a></strong><br />
</dt>
<dd>
Indicate the primary domain for the server.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpserverdomain_5d">[SmtpServerDomain]</a></strong><br />
</dt>
<dd>
If set, forces the domain name XMail uses inside the ESMTP banner used to support
CRAM-MD5 ESMTP authentication.
</dd>
<p></p>
<dt><strong><a name="item__5bpop3domain_5d">[POP3Domain]</a></strong><br />
</dt>
<dd>
Set the default domain for POP3 client connections.
</dd>
<p></p>
<dt><strong><a name="item__5bpostmaster_5d">[PostMaster]</a></strong><br />
</dt>
<dd>
Set the postmaster address.
</dd>
<p></p>
<dt><strong><a name="item__5berrorsadmin_5d">[ErrorsAdmin]</a></strong><br />
</dt>
<dd>
The email address that receives notification messages for every message that has had delivery errors.
If it is empty (allowed), the notification message is sent to the sender only.
</dd>
<p></p>
<dt><strong><a name="item__5btemperrorsadmin_5d">[TempErrorsAdmin]</a></strong><br />
</dt>
<dd>
The email address that receives notification for temporary delivery failures.
In case it's empty the notification message is sent to the sender only.
</dd>
<p></p>
<dt><strong><a name="item__5bdefaultsmtpgateways_5d">[DefaultSMTPGateways]</a></strong><br />
</dt>
<dd>
A comma separated list of SMTP servers XMail '<strong>must</strong>' use to send its mails.
This has the precedence over MX records.
</dd>
<p></p>
<dt><strong><a name="item__5bhelodomain_5d">[HeloDomain]</a></strong><br />
</dt>
<dd>
If this variable is specified and is not empty, its content is sent as HELO domain.
Otherwise the reverse lookup of the local IP is sent as HELO domain.
This helps to deal with remote SMTP servers that are set to check the reverse lookup
of the incoming IP.
</dd>
<p></p>
<dt><strong><a name="item__5bcheckmailerdomain_5d">[CheckMailerDomain]</a></strong><br />
</dt>
<dd>
Enable validation of the sender domain ('MAIL FROM:&lt;...&#64;xxx&gt;') by looking up DNS/MX entries.
</dd>
<p></p>
<dt><strong><a name="item__5bremovespoolerrors_5d">[RemoveSpoolErrors]</a></strong><br />
</dt>
<dd>
Indicate if mail has to be removed or stored in '<strong>froz</strong>'  directory after a failure in
delivery or filtering.
</dd>
<p></p>
<dt><strong><a name="item__5bnotifymsglinesextra_5d">[NotifyMsgLinesExtra]</a></strong><br />
</dt>
<dd>
Number of lines of the bounced message that have to be listed inside the notify message
(lines after
the headers section). Default is zero.
</dd>
<p></p>
<dt><strong><a name="item__5bnotifysendlogtosender_5d">[NotifySendLogToSender]</a></strong><br />
</dt>
<dd>
Enable/Disable sending the message log file inside the notify message to the sender.
Default is off (zero).
</dd>
<p></p>
<dt><strong><a name="item__5bnotifytrypattern_5d">[NotifyTryPattern]</a></strong><br />
</dt>
<dd>
List of delivery attempts that require the system to send a notification to the sender
(and eventually to '<strong>TempErrorsAdmin</strong>').
The list is a comma separated list of numbers (with no extra spaces) as in:
</dd>
<dd>
<pre>
 &quot;1,4,9&quot;</pre>
</dd>
<dd>
<p>Default is empty which means no notification is sent upon a delivery attempt failure.</p>
</dd>
<p></p>
<dt><strong><a name="item__5ballownullsender_5d">[AllowNullSender]</a></strong><br />
</dt>
<dd>
Enable null sender ('MAIL FROM:&lt;&gt;') messages to be accepted by XMail.
</dd>
<p></p>
<dt><strong><a name="item__5bnosenderbounce_5d">[NoSenderBounce]</a></strong><br />
</dt>
<dd>
When building bounce messages, use the null SMTP sender ('MAIL FROM:&lt;&gt;') instead
of the '<strong>PostMaster</strong>' address. This will affect only the SMTP sender, while the
message RFC822 headers will still contain the correct From: header.
</dd>
<p></p>
<dt><strong><a name="item__5bmaxmtaops_5d">[MaxMTAOps]</a></strong><br />
</dt>
<dd>
Set the maximum number of MTA relay steps before to declare the message as looped (default 16).
</dd>
<p></p>
<dt><strong><a name="item__5breceivedhdrtype_5d">[ReceivedHdrType]</a></strong><br />
</dt>
<dd>
Set the verbosity of the Received: message headers tag.
</dd>
<dl>
<dt><strong><a name="item__270_27">'0'</a></strong><br />
</dt>
<dd>
Standard (client IP shown , server IP not). Default.
</dd>
<p></p>
<dt><strong><a name="item__271_27">'1'</a></strong><br />
</dt>
<dd>
Verbose (client IP shown , server IP shown)
</dd>
<p></p>
<dt><strong><a name="item__272_27">'2'</a></strong><br />
</dt>
<dd>
Strict (no IP shown)
</dd>
<p></p>
<dt><strong><a name="item__273_27">'3'</a></strong><br />
</dt>
<dd>
Same as 0 but the client IP is not shown if the client authenticate itself.
</dd>
<p></p>
<dt><strong><a name="item__274_27">'4'</a></strong><br />
</dt>
<dd>
Same as 1 but the client IP is not shown if the client authenticate itself.
</dd>
<p></p></dl>
<dt><strong><a name="item__5bfetchhdrtags_5d">[FetchHdrTags]</a></strong><br />
</dt>
<dd>
Set the list of headers tags to be used to extract addresses from POP3 fetched messages
(<a href="#pop3links_tab">POP3LINKS.TAB</a>).
This is a comma delimited list (no extra space or TABs must be included inside the list) as in:
</dd>
<dd>
<pre>
 &quot;+X-Deliver-To,To,Cc&quot;</pre>
</dd>
<dd>
<p>Tags preceded by a '+' character make XMail stop scanning when an address is found inside the header tag.</p>
</dd>
<dd>
<p>Tags preceded by a '+' character must be listed before other tags.</p>
</dd>
<dd>
<p>The string ``+X-Deliver-To,To,Cc'' is the default if nothing is specified.</p>
</dd>
<p></p>
<dt><strong><a name="item__5bsmtp_2dmaxerrors_5d">[SMTP-MaxErrors]</a></strong><br />
</dt>
<dd>
Set the maximum number of errors allowed in a single SMTP session. When the maximum
number of allowed errors is exceeded, the connection will be automatically dropped.
If such variable is not set, or it is set to zero, the maximum number of errors will
be unlimited.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpmsgipbanspammers_5d">[SmtpMsgIPBanSpammers]</a></strong><br />
</dt>
<dd>
Used to set the message that is sent to the SMTP client when the client IP is listed inside
the file SPAMMER.TAB.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpmsgipbanspamaddress_5d">[SmtpMsgIPBanSpamAddress]</a></strong><br />
</dt>
<dd>
Used to set the message that is sent to the SMTP client when the client IP is listed inside
the file SPAM-ADDRESS.TAB.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpmsgipbanmaps_5d">[SmtpMsgIPBanMaps]</a></strong><br />
</dt>
<dd>
Used to set the message that is sent to the SMTP client when the client IP is listed inside
one of the ``CustMapsList''.
</dd>
<p></p>
<dt><strong><a name="item__5bcustomsmtpmessage_5d">[CustomSMTPMessage]</a></strong><br />
</dt>
<dd>
Set this to the message that you want to follow the standard SMTP error
response sent by XMail, as in (one line, remember the =&gt;):
</dd>
<dd>
<pre>
 &quot;Please open <a href="http://www.xmailserver.test/smtp_errors.html">http://www.xmailserver.test/smtp_errors.html</a> to get=&gt;
    more information about this error&quot;</pre>
</dd>
<dd>
<p>Please be aware the RFC821 fix the maximum reply line length to 512 bytes.</p>
</dd>
<p></p>
<dt><strong><a name="item__5ballowsmtpvrfy_5d">[AllowSmtpVRFY]</a></strong><br />
</dt>
<dd>
Enable the use of VRFY SMTP command. This flag may be forced by SMTP authentication.
</dd>
<p></p>
<dt><strong><a name="item__5ballowsmtpetrn_5d">[AllowSmtpETRN]</a></strong><br />
</dt>
<dd>
Enable the use of ETRN SMTP command. This flag may be forced by SMTP authentication.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpmindiskspace_5d">[SmtpMinDiskSpace]</a></strong><br />
</dt>
<dd>
Minimum disk space (in Kb) that is requested before accepting an SMTP connection.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpminvirtmemspace_5d">[SmtpMinVirtMemSpace]</a></strong><br />
</dt>
<dd>
Minimum virtual memory (in Kb) that is requested before accepting an SMTP connection.
</dd>
<p></p>
<dt><strong><a name="item__5bpop3minvirtmemspace_5d">[Pop3MinVirtMemSpace]</a></strong><br />
</dt>
<dd>
Minimum virtual memory (in Kb) that is requested before accepting a POP3 connection.
</dd>
<p></p>
<dt><strong><a name="item__5bpop3syncerroraccount_5d">[Pop3SyncErrorAccount]</a></strong><br />
</dt>
<dd>
This defines the email account (MUST be handled locally) that receives all
fetched email that XMail has not been able to deliver.
</dd>
<p></p>
<dt><strong><a name="item__5benableauthsmtp_2dpop3_5d">[EnableAuthSMTP-POP3]</a></strong><br />
</dt>
<dd>
Enable SMTP after POP3 authentication (default on).
</dd>
<p></p>
<dt><strong><a name="item__5bmaxmessagesize_5d">[MaxMessageSize]</a></strong><br />
</dt>
<dd>
Set the maximum message size in Kb that is possible to send through the server.
</dd>
<p></p>
<dt><strong><a name="item__5bdefaultsmtpperms_5d">[DefaultSmtpPerms]</a></strong><br />
</dt>
<dd>
This list SMTP permissions assigned to users looked up inside <a href="#mailusers_tab">MAILUSERS.TAB</a>
during SMTP authentication.
It also defines the permissions for users authenticated with SMTP after POP3.
</dd>
<p></p>
<dt><strong><a name="item__5bcustmapslist_5d">[CustMapsList]</a></strong><br />
</dt>
<dd>
This is a list a user can use to set custom maps checking. The list has the given (strict) format:
</dd>
<dd>
<p>maps-root:code,maps-root:code...</p>
</dd>
<dd>
<p>Where  maps-root  is the root for the dns query (ie. dialups.mail-abuse.org.)
and the code can be:</p>
</dd>
<dl>
<dt><strong>'1'</strong><br />
</dt>
<dd>
the connection is drooped soon
</dd>
<p></p>
<dt><strong><a name="item__220_22">``0''</a></strong><br />
</dt>
<dd>
the connection is kept alive but only authenticated users can send mail
</dd>
<p></p>
<dt><strong><a name="item__27_2ds_27">'-S'</a></strong><br />
</dt>
<dd>
the peer can send messages but a delay of S seconds is introduced between commands
</dd>
<p></p></dl>
<dt><strong><a name="item__5bsmtp_2drdnscheck_5d">[SMTP-RDNSCheck]</a></strong><br />
</dt>
<dd>
Indicate if XMail must do an RDNS lookup before accepting a incoming SMTP connection.
If 0, the check is not performed; if 1 and the check fails,
the user receives a 'server use forbidden'
at MAIL_FROM time;
if -S (S &gt; 0) and the check fails, a delay of S seconds between SMTP commands is used to prevent
massive spamming.
</dd>
<dd>
<p>SMTP authentication overrides the denial set by this option by giving authenticated users
the ability to access the server from 'mapped' IPs.</p>
</dd>
<p></p>
<dt><strong><a name="item__5bsmartdnshost_5d">[SmartDNSHost]</a></strong><br />
</dt>
<dd>
Setup a list of smart DNS hosts to which are directed DNS queries with recursion
bit set to true. Such DNS hosts must support DNS recursion in queries.
The format is:
</dd>
<dd>
<pre>
 dns.home.bogus.net:tcp,192.168.1.1:udp,...</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bdisableemitauthuser_5d">[DisableEmitAuthUser]</a></strong><br />
</dt>
<dd>
Enable/disable the emission the the 'X-AuthUser:' mail header for authenticated users.
Valid values are ``0'' or '1', default is ``0'' (emission enabled).
</dd>
<p></p>
<dt><strong><a name="item__5bdyndnssetup_5d">[DynDnsSetup]</a></strong><br />
</dt>
<dd>
Give the possibility to handle dynamic IP domain registration to dynamic IP servers.
One of these service providers is 'www.dyndns.org' whose site you can watch for
registrations and more info.
</dd>
<dd>
<p>The string has the format:</p>
</dd>
<dd>
<pre>
 server,port,HTTP-GET-String[,username,password]</pre>
</dd>
<dd>
<p>For Example:</p>
</dd>
<dd>
<p>members.dyndns.org,80,/nic/dyndns?action=edit&amp;started=1&amp;hostname=YES&amp;host_id=yourhost.ourdomain.ext&amp;myip=%s&amp;wildcard=OFF&amp;mx=mail.exchanger.ext&amp;backmx=NO,foouser,foopasswd</p>
</dd>
<dd>
<p>or</p>
</dd>
<dd>
<p>www.dns4ever.com,80,/sys/u.cgi?d=DOMAIN&amp;u=USERNAME&amp;p=PASSWORD&amp;i=%s</p>
</dd>
<dd>
<p>where:</p>
</dd>
<dl>
<dt><strong><a name="item_domain">DOMAIN</a></strong><br />
</dt>
<dd>
the domain you've registered
</dd>
<p></p>
<dt><strong><a name="item_username">USERNAME</a></strong><br />
</dt>
<dd>
the username you get from service provider
</dd>
<p></p>
<dt><strong><a name="item_password">PASSWORD</a></strong><br />
</dt>
<dd>
the password you get from service provider
</dd>
<p></p></dl>
<p>The %s in HTTP-GET-String is replaced with the IP address to register.</p>
<dt><strong><a name="item__5bsmtpconfig_5d">[SmtpConfig]</a></strong><br />
</dt>
<dd>
Default SMTP server config loaded if specific server IP config is not found.
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpconfig_2dxxx_2eyyy_2ezzz_2ewww_5d">[SmtpConfig-XXX.YYY.ZZZ.WWW]</a></strong><br />
</dt>
<dd>
Specific IP SMTP server config.
The variable value is a comma separated sequence of configuration tokens whose
meaning is:
</dd>
<dl>
<dt><strong><a name="item_mail_2dauth">mail-auth</a></strong><br />
</dt>
<dd>
authentication required to send mail to the server.
Please note that by setting this value everything requires authentication,
even for sending to local domains, and this is probably not what you want.
</dd>
<p></p></dl>
</dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="message_filters">MESSAGE FILTERS</a></h1>
<p>This feature offers a way to filter messages by providing the ability to
execute external programs, such as scripts or real executables.
These 'filters' may examine and/or modify messages and inform XMail of
their actions with a return value.</p>
<p>This feature offers the ability to inspect and modify messages, giving a way
to reject messages based on content, alter messages (address rewriting)
and so on.</p>
<p>If this filters returns '<strong>4, 5 or 6</strong>' the message is rejected and
is stopped in its travel.
If the filter modifies the message it must return '<strong>7</strong>'.</p>
<p>Additional flags are allowed to be returned to XMail as a result of filter processing
by adding the flags value to the exits code above listed. The currently defined
flags are :</p>
<dl>
<dt><strong><a name="item__2716_27">'16'</a></strong><br />
</dt>
<dd>
Stop selected filter list processing.
</dd>
<p></p></dl>
<p>Filter flags are additive and if more than one flag need to be specified, their values
must be added together. If a filter ``raw'' exit code is <strong>RC</strong> and the filter needs
to return extra flags <strong>FILTER-SUM</strong>, the final return code <strong>FRC</strong> must be :</p>
<p><strong>FRC</strong> = <strong>RC</strong> + <strong>FILTER-SUM</strong></p>
<p>Example. Suppose a filter modified the message and hence needs to return <strong>7</strong> as return code.
Suppose also that a filter wants to block the filter selection list processing by
specifying a flags value of <strong>16</strong>, the value to be returned will be :</p>
<p><strong>FRC</strong> = <strong>7</strong> + <strong>16</strong> = <strong>23</strong></p>
<p>Filter selection is driven by two files '<strong>FILTERS.IN.TAB</strong>' and '<strong>FILTERS.OUT.TAB</strong>'
located inside the $MAIL_ROOT/ directory and that have the following format:</p>
<pre>
 &quot;sender&quot;[TAB]&quot;recipient&quot;[TAB]&quot;remote-addr&quot;[TAB]&quot;local-addr&quot;[TAB]&quot;filename&quot;[NEWLINE]</pre>
<p>For example:</p>
<pre>
 &quot;*@bad-domain.com&quot; &quot;*&quot; &quot;0.0.0.0/0&quot; &quot;0.0.0.0/0&quot; &quot;av-filter.tab&quot;
 &quot;*&quot; &quot;clean@purified.net&quot; &quot;0.0.0.0/0&quot; &quot;0.0.0.0/0&quot; &quot;spam-block.tab&quot;
 &quot;*&quot; &quot;*&quot; &quot;192.168.1.0/24&quot; &quot;0.0.0.0/0&quot; &quot;archive.tab&quot;</pre>
<p>where the file ``av-filter.tab'' must be present inside the $MAIL_ROOT/filters directory.
The ``sender'' and the ``recipient'' are resolved to the real account when possible.
Address selection mask are formed by an IP address (network) plus the number of
valid bits inside the network mask. The file '<strong>FILTERS.IN.TAB</strong>' lists filters that
have to be applied to inbound messages (going to local mailboxes) while the file
'<strong>FILTERS.OUT.TAB</strong>' lists filters that have to be applied to outbound messages
(delivered remotely).
All four (sender+recipient+remote-addr+local-addr) selection fields must have a match
in order ``filename'' to be evaluated.
The syntax of the filter file is:</p>
<pre>
 &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>or:</p>
<pre>
 &quot;!flags&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>Each file may contain multiple commands, that will be executed in strictly sequential
order. The first command that will trigger a rejection code will make the filtering
process to end. The '<strong>flags</strong>' parameter is a comma-separated list of flags that drives
the filter execution. The syntax of each flag is either FLAG or FLAG=VAL. Currently
supported flags are:</p>
<dl>
<dt><strong><a name="item_aex">aex</a></strong><br />
</dt>
<dd>
exclude filter execution in case of authenticated sender
</dd>
<p></p></dl>
<p>Each argument can be a macro also:</p>
<dl>
<dt><strong>@@FROM</strong><br />
</dt>
<dd>
the sender of the message
</dd>
<p></p>
<dt><strong><a name="item__40_40rfrom">@@RFROM</a></strong><br />
</dt>
<dd>
the sender of the message resolved to the real account, when possible (alias resolution)
</dd>
<p></p>
<dt><strong>@@RCPT</strong><br />
</dt>
<dd>
the target of the message
</dd>
<p></p>
<dt><strong>@@RRCPT</strong><br />
</dt>
<dd>
the target of the message resolved to the real account, when possible (alias resolution)
</dd>
<p></p>
<dt><strong><a name="item__40_40remoteaddr">@@REMOTEADDR</a></strong><br />
</dt>
<dd>
remote IP address and port of the sender
</dd>
<p></p>
<dt><strong><a name="item__40_40localaddr">@@LOCALADDR</a></strong><br />
</dt>
<dd>
local IP address and port where the message has been accepted
</dd>
<p></p>
<dt><strong>@@FILE</strong><br />
</dt>
<dd>
the message file path (the external command may modify the file if it returns '<strong>7</strong>'
as command exit value.)
</dd>
<p></p>
<dt><strong>@@MSGID</strong><br />
</dt>
<dd>
with the (XMail unique) message id
</dd>
<p></p>
<dt><strong>@@MSGREF</strong><br />
</dt>
<dd>
the reference SMTP message id
</dd>
<p></p>
<dt><strong>@@USERAUTH</strong><br />
</dt>
<dd>
name of the SMTP authenticated user, or ``-'' if no authentication has been supplied
</dd>
<p></p></dl>
<p>Here '<strong>command</strong>' is the name of an external program that processes the message and
returns its processing result. If it returns '<strong>6</strong>' the message is rejected and a notification
message is sent to the sender. By returning '<strong>5</strong>' the message is rejected
without notification.
While returning '<strong>4</strong>' the message is rejected without notification and without being frozen
(a '<strong>5</strong>' response could lead to a frozen message if the <a href="#server_tab">SERVER.TAB</a> configuration enables this).
If all filters return values different from '<strong>6, 5 and 4</strong>' the message continues its trip.
The filter command may also modify the file
(AV scanning, content filter, message rewriting, etc) by returning '<strong>7</strong>'.
The filter '<strong>MUST</strong>' return '<strong>7</strong>' in case it modifies the message.
If the filter changes the message file it '<strong>MUST</strong>' keep the message structure and
it '<strong>MUST</strong>' terminate all line with &lt;CR&gt;&lt;LF&gt;. The filter has also the ability to return
a one-line custom return message by creating a file named @@FILE.rej holding the message
in the very first line. This file should be created '<strong>ONLY</strong>' when the filter returns a
rejection code ('<strong>6, 5 and 4</strong>')and '<strong>NEVER</strong>' in case of passthru code ('<strong>7</strong>') or modify code.</p>
<p>The spool files has this structure:</p>
<pre>
 Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt;       [ 5th line ]
 &lt;&lt;MAIL-DATA&gt;&gt;       [ 6th line ]
 ...</pre>
<p>After the '<strong>&lt;&lt;MAIL-DATA&gt;&gt;</strong>' tag (5th line) the message follows. The message is composed
of a headers section and, after the first empty line, the message body. The format of the ``Info Data''
line is:</p>
<pre>
 ClientDomain;ClientIP;ClientPort;ServerDomain;ServerIP;ServerPort;Time;Logo</pre>
<p>'<strong>EXTREME</strong>' care must be used when modifying the message because the filter will be working
on the real message, and a badly reformatted file will lead to message loss. The spool file
header (any data before &lt;&lt;MAIL-DATA&gt;&gt;) '<strong>MUST</strong>' be preserved as is by the filter in case of
message rewrite happens.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="smtp_message_filters">SMTP MESSAGE FILTERS</a></h1>
<p>Besides having the ability to perform off-line message filtering, XMail gives the user
the power to run filters during the SMTP session. Two files drive the SMTP on-line filtering,
and these are '<strong>FILTERS.PRE-DATA.TAB</strong>' and '<strong>FILTERS.POST-DATA.TAB</strong>'. The file
'<strong>FILTERS.PRE-DATA.TAB</strong>' contains one or more commands to be executed after the remote
SMTP client sends the DATA command, and before XMail sends the response to the command.
Using such filters, the user can tell XMail if or if not accept the following DATA transaction
and, in case of rejection, the user is also allowed to specify a custom message to be sent
to the remote SMTP client. The file '<strong>FILTERS.POST-DATA.TAB</strong>' contains one or more commands
to be executed after XMail received the whole client DATA, and before XMail sends the final
response to the DATA command (final messages ack). The files '<strong>FILTERS.PRE-DATA.TAB</strong>'
and '<strong>FILTERS.POST-DATA.TAB</strong>' conatins zero or more lines with the following format:</p>
<pre>
 &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>or:</p>
<pre>
 &quot;!flags&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</pre>
<p>Each file may contain multiple commands, that will be executed in strictly sequential
order. The first command that will trigger a rejection code will make the filtering
process to end. The '<strong>flags</strong>' parameter is a comma-separated list of flags that drives
the filter execution. The syntax of each flag is either FLAG or FLAG=VAL. Currently
supported flags are:</p>
<dl>
<dt><strong>aex</strong><br />
</dt>
<dd>
exclude filter execution in case of authenticated sender
</dd>
<p></p></dl>
<p>Each argument can be a macro also:</p>
<dl>
<dt><strong>@@FILE</strong><br />
</dt>
<dd>
message file path
</dd>
<p></p>
<dt><strong>@@USERAUTH</strong><br />
</dt>
<dd>
name of the SMTP authenticated user, or ``-'' if no authentication has been supplied
</dd>
<p></p>
<dt><strong>@@REMOTEADDR</strong><br />
</dt>
<dd>
remote IP address and port of the sender
</dd>
<p></p>
<dt><strong>@@LOCALADDR</strong><br />
</dt>
<dd>
local IP address and port where the message has been accepted
</dd>
<p></p></dl>
<p>Filter commands have the ability to inspect and modify the content of the message
(or info) file. The exit code of commands executed by XMail are used to tell XMail
the action that has to be performed as a cosequence of the filter. The exit code
is composed by a raw exit code and additional flags. Currently defined flags are:</p>
<dl>
<dt><strong>'16'</strong><br />
</dt>
<dd>
Stop selected filter list processing.
</dd>
<p></p></dl>
<p>Currently defined raw exit codes are:</p>
<dl>
<dt><strong>'3'</strong><br />
</dt>
<dd>
Reject the message.
</dd>
<p></p></dl>
<p>Any other exit codes will make XMail to accept the message, and can be used also when
changing the content of the @@FILE file. '<strong>EXTREME</strong>' care must be used when changing the
@@FILE file, since XMail expect the file format to be correct. Also, it is important to
preserve the &lt;CR&gt;&lt;LF&gt; line termination of the file itself.
When rejecting the message, the filter command has the ability to specify the SMTP
status code that XMail will send to the remote SMTP client, by creating a file named
@@FILE.rej containing the message in the very first line. Such file will be automatically
removed by XMail. The data passed to filter commands inside @@FILE varies depending
if the command is listed inside '<strong>FILTERS.PRE-DATA.TAB</strong>' or inside '<strong>FILTERS.POST-DATA.TAB</strong>'.
Commands listed inside '<strong>FILTERS.PRE-DATA.TAB</strong>' will receive the following data stored
inside @@FILE:</p>
<pre>
 Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt; {...} [ 5th line ]
 ...</pre>
<p>The file can have one or more ``RCPT TO'' lines. The format of the ``Info Data''
line is:</p>
<pre>
 ClientDomain;ClientIP;ClientPort;ServerDomain;ServerIP;ServerPort;Time;Logo</pre>
<p>Commands listed inside '<strong>FILTERS.POST-DATA.TAB</strong>' will receive the following data stored
inside @@FILE:</p>
<pre>
 Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt; {...} [ 5th line ]
 ...
 &lt;&lt;MAIL-DATA&gt;&gt;
 ...</pre>
<p>After the '<strong>&lt;&lt;MAIL-DATA&gt;&gt;</strong>' tag the message follows. The message is composed
of a headers section and, after the first empty line, the message body. The format of the
RCPT line is:</p>
<pre>
 RCPT TO:&lt;address&gt; {ra=real-address}</pre>
<p>where ``real-address'' is the ``address'' after it has been translated (if aliases applies)
to the real local address. Otherwise it holds the same value of ``address''.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="user_tab_variables">USER.TAB VARIABLES</a></h1>
<p>The following variables are for use in the <a href="#user_tab">USER.TAB</a> configuration file.</p>
<dl>
<dt><strong><a name="item__5brealname_5d">[RealName]</a></strong><br />
</dt>
<dd>
Full user name, ie.:
</dd>
<dd>
<pre>
 &quot;RealName&quot;  &quot;Davide Libenzi&quot;</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bhomepage_5d">[HomePage]</a></strong><br />
</dt>
<dd>
User home page, ie.:
</dd>
<dd>
<pre>
 &quot;HomePage&quot;  &quot;<a href="http://www.xmailserver.org/davide.html&quot">http://www.xmailserver.org/davide.html&quot</a>;</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bmaxmbsize_5d">[MaxMBSize]</a></strong><br />
</dt>
<dd>
Max user mailbox size in Kb, ie.:
</dd>
<dd>
<pre>
 &quot;MaxMBSize&quot; &quot;30000&quot;</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bclosedml_5d">[ClosedML]</a></strong><br />
</dt>
<dd>
Specify if the mailing list is closed only to subscribed users, ie.:
</dd>
<dd>
<pre>
 &quot;ClosedML&quot;  &quot;1&quot;</pre>
</dd>
<p></p>
<dt><strong><a name="item__5blistsender_5d">[ListSender]</a></strong><br />
</dt>
<dd>
Specify the mailing list sender or administrator:
</dd>
<dd>
<pre>
 &quot;ListSender&quot;    &quot;ml-admin@xmailserver.org&quot;</pre>
</dd>
<dd>
<p>This variable should be set to avoid delivery error notifications to reach the
original message senders.</p>
</dd>
<p></p>
<dt><strong><a name="item__5bsmtpperms_5d">[SmtpPerms]</a></strong><br />
</dt>
<dd>
User SMTP permissions (see SMTPAUTH.TAB for info).
</dd>
<p></p>
<dt><strong><a name="item__5breceiveenable_5d">[ReceiveEnable]</a></strong><br />
</dt>
<dd>
Set to '1' if the account can receive email, '0' if you want to disable the account from receiving messages.
</dd>
<p></p>
<dt><strong><a name="item__5bpopenable_5d">[PopEnable]</a></strong><br />
</dt>
<dd>
Set to '1' if you want to enable the account to fetch POP3 messages, '0' otherwise.
</dd>
<p></p>
<dt><strong><a name="item__5busereplyto_5d">[UseReplyTo]</a></strong><br />
</dt>
<dd>
Enable/Disable the emission of the Reply-To: header for mailing list's messages (default 1).
</dd>
<p></p>
<dt><strong>[MaxMessageSize]</strong><br />
</dt>
<dd>
Set the maximum message size (in Kb) that the user is able to send through the server.
Overrides the SERVER.TAB variable.
</dd>
<p></p>
<dt><strong>[DisableEmitAuthUser]</strong><br />
</dt>
<dd>
Enable/disable the emission the the 'X-AuthUser:' mail header for authenticated users.
Valid values are '0' or '1', default is '0' (emission enabled). This variable overrides
the SERVER.TAB one when present.
</dd>
<p></p></dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="mail_routing_through_addresses">MAIL ROUTING THROUGH ADDRESSES</a></h1>
<p>A full implementation of SMTP protocol allows the ability to perform mail routing
bypassing DNS MX records by means of setting, in a ruled way, the 'RCPT TO: &lt;&gt;' request.
A mail from '<strong>xuser&#64;hostz</strong>' directed to
'<strong>&#64;hosta,&#64;hostb:foouser&#64;hostc</strong>' is received
by '<strong>&#64;hosta</strong>' then sent to '<strong>&#64;hostb</strong>' using
'<strong>MAIL FROM: &lt;&#64;hosta:xuser&#64;hostz</strong>&gt;'
and '<strong>RCPT TO: &lt;&#64;hostb:foouser&#64;hostc</strong>&gt;'.
The message is then sent to '<strong>&#64;'hostc</strong> using
'<strong>MAIL FROM: &lt;&#64;hostb,&#64;hosta:xuser&#64;hostz</strong>&gt;'
and '<strong>RCPT TO: &lt;foouser&#64;hostc</strong>&gt;'.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="xmail_spool_design">XMAIL SPOOL DESIGN</a></h1>
<p>The new spool fs tree format has been designed to enable XMail to handle very
large queues.
Instead of having a single spool directory (like versions older than 0.61)
a two layer deep splitting has been introduced so that its structure is:</p>
<pre>
 0   &lt;dir&gt;
   0   &lt;dir&gt;
     mess    &lt;dir&gt;
     rsnd    &lt;dir&gt;
     info    &lt;dir&gt;
     temp    &lt;dir&gt;
     slog    &lt;dir&gt;
     cust    &lt;dir&gt;
     froz    &lt;dir&gt;
   ...
 ...</pre>
<p>When XMail needs to create a new spool file a spool path is chosen in a random way and
a new file with the format:</p>
<pre>
 mstime.tid.seq.hostname</pre>
<p>is created inside the '<strong>temp</strong>' subdirectory.
When the spool file is ready to be committed, it's moved into the '<strong>mess</strong>' subdirectory that holds
newer spool files.
If XMail fails sending a new message (the ones in  mess  subdirectory) it creates a log file
(with the same name of the message file) inside the '<strong>slog</strong>' subdirectory and move the file
from '<strong>mess</strong>'  to '<strong>rsnd</strong>'.
During the message sending the message itself is locked by creating a file inside the '<strong>lock</strong>'
subdirectory (with the same name of the message file).
If the message has permanent delivery errors or is expired and if the option '<strong>RemoveSpoolErrors</strong>'
of the '<strong>SERVER.TAB</strong>' file is off, the message file is moved into the '<strong>froz</strong>' subdirectory.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="smtp_commands">SMTP COMMANDS</a></h1>
<p>These are commands understood by ESMTP server:</p>
<dl>
<dt><strong><a name="item_mail_from_3a_3c_3e">MAIL FROM:&lt;&gt;</a></strong><br />
</dt>
<dt><strong><a name="item_rcpt_to_3a_3c_3e">RCPT TO:&lt;&gt;</a></strong><br />
</dt>
<dt><strong><a name="item_data">DATA</a></strong><br />
</dt>
<dt><strong><a name="item_helo">HELO</a></strong><br />
</dt>
<dt><strong><a name="item_ehlo">EHLO</a></strong><br />
</dt>
<dt><strong><a name="item_auth">AUTH</a></strong><br />
</dt>
<dt><strong><a name="item_rset">RSET</a></strong><br />
</dt>
<dt><strong><a name="item_vrfy">VRFY</a></strong><br />
</dt>
<dt><strong><a name="item_etrn">ETRN</a></strong><br />
</dt>
<dt><strong><a name="item_noop">NOOP</a></strong><br />
</dt>
<dt><strong><a name="item_help">HELP</a></strong><br />
</dt>
<dt><strong><a name="item_quit">QUIT</a></strong><br />
</dt>
</dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="pop3_commands">POP3 COMMANDS</a></h1>
<p>These are commands understood by POP3 server:</p>
<dl>
<dt><strong><a name="item_user">USER</a></strong><br />
</dt>
<dt><strong><a name="item_pass">PASS</a></strong><br />
</dt>
<dt><strong><a name="item_apop">APOP</a></strong><br />
</dt>
<dt><strong><a name="item_stat">STAT</a></strong><br />
</dt>
<dt><strong><a name="item_list">LIST</a></strong><br />
</dt>
<dt><strong><a name="item_uidl">UIDL</a></strong><br />
</dt>
<dt><strong>QUIT</strong><br />
</dt>
<dt><strong><a name="item_retr">RETR</a></strong><br />
</dt>
<dt><strong><a name="item_top">TOP</a></strong><br />
</dt>
<dt><strong><a name="item_dele">DELE</a></strong><br />
</dt>
<dt><strong>NOOP</strong><br />
</dt>
<dt><strong><a name="item_last">LAST</a></strong><br />
</dt>
<dt><strong>RSET</strong><br />
</dt>
</dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="command_line">COMMAND LINE</a></h1>
<p>Most of XMail configuration settings are command line tunables.
These are command line switches organized by server.</p>
<dl>
<dt><strong><a name="item__5bxmail_5d">[XMAIL]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dms_pathname">-Ms pathname</a></strong><br />
</dt>
<dd>
Mail root path (also settable with MAIL_ROOT environment).
</dd>
<p></p>
<dt><strong><a name="item__2dmd">-Md</a></strong><br />
</dt>
<dd>
Activate debug (verbose) mode.
</dd>
<p></p>
<dt><strong><a name="item__2dmr_hours">-Mr hours</a></strong><br />
</dt>
<dd>
Set log rotate hours step.
</dd>
<p></p>
<dt><strong><a name="item__2dmx_split_2dlevel">-Mx split-level</a></strong><br />
</dt>
<dd>
Set the queue split level. The value you set here is rounded to the lower
prime number higher or equal than the value you've set.
</dd>
<p></p>
<dt><strong><a name="item__2dmr_bytes">-MR bytes</a></strong><br />
</dt>
<dd>
Set the size of the socket's receive buffer in bytes (rounded up to 1024).
</dd>
<p></p>
<dt><strong><a name="item__2dms_bytes">-MS bytes</a></strong><br />
</dt>
<dd>
Set the size of the socket's send buffer in bytes (rounded up to 1024).
</dd>
<p></p>
<dt><strong><a name="item__2dmm">-MM</a></strong><br />
</dt>
<dd>
Setup XMail to use 'Maildir' delivery (default on Unix).
</dd>
<p></p>
<dt><strong><a name="item__2dmm">-Mm</a></strong><br />
</dt>
<dd>
Setup XMail to use 'mailbox' delivery (default on Windows).
</dd>
<p></p>
<dt><strong><a name="item__2dmd_ndirs">-MD ndirs</a></strong><br />
</dt>
<dd>
Set the number of subdirectories allocated for the DNS cache files storage ( default 101 ).
</dd>
<p></p></dl>
<dt><strong><a name="item__5bpop3_5d">[POP3]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dpp_port">-Pp port</a></strong><br />
</dt>
<dd>
Set POP3 server port (if you change this you must know what you're doing).
</dd>
<p></p>
<dt><strong><a name="item__2dpt_timeout">-Pt timeout</a></strong><br />
</dt>
<dd>
Set POP3 session timeout (seconds) after which the server closes.
the connection if it does not receive any commands.
</dd>
<p></p>
<dt><strong><a name="item__2dpl">-Pl</a></strong><br />
</dt>
<dd>
Enable POP3 logging.
</dd>
<p></p>
<dt><strong><a name="item__2dpw_timeout">-Pw timeout</a></strong><br />
</dt>
<dd>
Set the delay timeout in response to a bad POP3 login. Such time is
doubled at the next bad login.
</dd>
<p></p>
<dt><strong><a name="item__2dph">-Ph</a></strong><br />
</dt>
<dd>
Hang the connection in bad login response.
</dd>
<p></p>
<dt><strong><a name="item__2dpi_ip_5b_3aport_5d">-PI ip[:port]</a></strong><br />
</dt>
<dd>
Bind server to the specified ip address and (optional) port (can be multiple).
</dd>
<p></p>
<dt><strong><a name="item__2dpx_nthreads">-PX nthreads</a></strong><br />
</dt>
<dd>
Set the maximum number of threads for POP3 server.
</dd>
<p></p></dl>
<dt><strong>[SMTP]</strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dsp_port">-Sp port</a></strong><br />
</dt>
<dd>
Set SMTP server port (if you change this you must know what you're doing).
</dd>
<p></p>
<dt><strong><a name="item__2dst_timeout">-St timeout</a></strong><br />
</dt>
<dd>
Set SMTP session timeout (seconds) after which the server closes
the connection if no commands are received.
</dd>
<p></p>
<dt><strong><a name="item__2dsl">-Sl</a></strong><br />
</dt>
<dd>
Enable SMTP logging.
</dd>
<p></p>
<dt><strong><a name="item__2dsi_ip_5b_3aport_5d">-SI ip[:port]</a></strong><br />
</dt>
<dd>
Bind server to the specified ip address and (optional) port (can be multiple).
</dd>
<p></p>
<dt><strong><a name="item__2dsx_nthreads">-SX nthreads</a></strong><br />
</dt>
<dd>
Set the maximum number of threads for SMTP server.
</dd>
<p></p>
<dt><strong><a name="item__2dsr_maxrcpts">-Sr maxrcpts</a></strong><br />
</dt>
<dd>
Set the maximu number of recipients for a single SMTP message (default 100).
</dd>
<p></p>
<dt><strong><a name="item__2dse_nsecs">-Se nsecs</a></strong><br />
</dt>
<dd>
Set the expire timeout for a POP3 authentication IP (default 900).
</dd>
<p></p></dl>
<dt><strong><a name="item__5bsmail_5d">[SMAIL]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dqn_nthreads">-Qn nthreads</a></strong><br />
</dt>
<dd>
Set the number of mailer threads.
</dd>
<p></p>
<dt><strong><a name="item__2dqt_timeout">-Qt timeout</a></strong><br />
</dt>
<dd>
Set the time to be wait for a next try after send failure. Default 480.
</dd>
<p></p>
<dt><strong><a name="item__2dqi_ratio">-Qi ratio</a></strong><br />
</dt>
<dd>
Set the increment ratio of the reschedule time in sending a messages.
At every failure in delivery a message, reschedule time T is incremented
by (T / ratio), therefore :
</dd>
<dd>
<pre>
 T(i) = T(i-1) + T(i-1)/ratio.</pre>
</dd>
<dd>
<p>If you set this ratio to zero, T remain unchanged over delivery tentatives.
Default 16.</p>
</dd>
<p></p>
<dt><strong><a name="item__2dqr_nretries">-Qr nretries</a></strong><br />
</dt>
<dd>
Set the maximum number of times to try to send the message. Default 32.
</dd>
<p></p>
<dt><strong><a name="item__2dql">-Ql</a></strong><br />
</dt>
<dd>
Enable SMAIL logging.
</dd>
<p></p>
<dt><strong><a name="item__2dqt_timeout">-QT timeout</a></strong><br />
</dt>
<dd>
Timeout value for filters commands in seconds. Default 90.
</dd>
<p></p>
<dt><strong><a name="item__2dqg">-Qg</a></strong><br />
</dt>
<dd>
Enable filter logging.
</dd>
<p></p></dl>
<dt><strong><a name="item__5bpsync_5d">[PSYNC]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dyi_interval">-Yi interval</a></strong><br />
</dt>
<dd>
Set external POP3 accounts sync interval. Setting this to zero will disable
the PSYNC task. Default 120.
</dd>
<p></p>
<dt><strong><a name="item__2dyt_nthreads">-Yt nthreads</a></strong><br />
</dt>
<dd>
Set the number of POP3 sync threads.
</dd>
<p></p>
<dt><strong><a name="item__2dyl">-Yl</a></strong><br />
</dt>
<dd>
Enable PSYNC logging.
</dd>
<p></p></dl>
<dt><strong><a name="item__5bfinger_5d">[FINGER]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dfp_port">-Fp port</a></strong><br />
</dt>
<dd>
Set FINGER server port (if you change this you must know what you're doing).
</dd>
<p></p>
<dt><strong><a name="item__2dfl">-Fl</a></strong><br />
</dt>
<dd>
Enable FINGER logging.
</dd>
<p></p>
<dt><strong><a name="item__2dfi_ip_5b_3aport_5d">-FI ip[:port]</a></strong><br />
</dt>
<dd>
Bind server to the specified ip address and (optional) port (can be multiple).
</dd>
<p></p></dl>
<dt><strong><a name="item__5bctrl_5d">[CTRL]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dcp_port">-Cp port</a></strong><br />
</dt>
<dd>
Set CTRL server port (if you change this you must know what you're doing).
</dd>
<p></p>
<dt><strong><a name="item__2dct_timeout">-Ct timeout</a></strong><br />
</dt>
<dd>
Set CTRL session timeout (seconds) after which the server closes
the connection if no commands are received.
</dd>
<p></p>
<dt><strong><a name="item__2dcl">-Cl</a></strong><br />
</dt>
<dd>
Enable CTRL logging.
</dd>
<p></p>
<dt><strong><a name="item__2dci_ip_5b_3aport_5d">-CI ip[:port]</a></strong><br />
</dt>
<dd>
Bind server to the specified ip address and (optional) port (can be multiple).
</dd>
<p></p>
<dt><strong><a name="item__2dcx_nthreads">-CX nthreads</a></strong><br />
</dt>
<dd>
Set the maximum number of threads for CTRL server.
</dd>
<p></p></dl>
<dt><strong><a name="item__5blmail_5d">[LMAIL]</a></strong><br />
</dt>
<dl>
<dt><strong><a name="item__2dln_nthreads">-Ln nthreads</a></strong><br />
</dt>
<dd>
Set the number of local mailer threads.
</dd>
<p></p>
<dt><strong><a name="item__2dlt_timeout">-Lt timeout</a></strong><br />
</dt>
<dd>
Set the sleep timeout for LMAIL threads (in seconds, default 2).
</dd>
<p></p>
<dt><strong><a name="item__2dll">-Ll</a></strong><br />
</dt>
<dd>
Enable local mail logging.
</dd>
<p></p></dl>
</dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="xmail_admin_protocol">XMAIL ADMIN PROTOCOL</a></h1>
<p>It's possible to remote admin XMail due to the existence of a 'controller server'
that runs with XMail and waits for TCP/IP connections on a port (6017 or tunable
via a '-Cp nport') command line option.</p>
<p>Admin protocol details:</p>
<dl>
<dt><strong><a name="item__22description_22"><a href="#description">Description</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_a_user_22"><a href="#adding_a_user">Adding a user</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_a_user_22"><a href="#deleting_a_user">Deleting a user</a></a></strong><br />
</dt>
<dt><strong><a name="item__22changing_a_user_27s_password_22"><a href="#changing_a_user_s_password">Changing a user's password</a></a></strong><br />
</dt>
<dt><strong><a name="item__22authenticate_user_22"><a href="#authenticate_user">Authenticate user</a></a></strong><br />
</dt>
<dt><strong><a name="item__22retrieve_user_statistics_22"><a href="#retrieve_user_statistics">Retrieve user statistics</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_an_alias_22"><a href="#adding_an_alias">Adding an alias</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_an_alias_22"><a href="#deleting_an_alias">Deleting an alias</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_aliases_22"><a href="#listing_aliases">Listing aliases</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_user_vars_22"><a href="#listing_user_vars">Listing user vars</a></a></strong><br />
</dt>
<dt><strong><a name="item__22setting_user_vars_22"><a href="#setting_user_vars">Setting user vars</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_users_22"><a href="#listing_users">Listing users</a></a></strong><br />
</dt>
<dt><strong><a name="item__22getting_mailproc_2etab_file_22"><a href="#getting_mailproc_tab_file">Getting mailproc.tab file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22setting_mailproc_2etab_file_22"><a href="#setting_mailproc_tab_file">Setting mailproc.tab file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_a_mailing_list_user_22"><a href="#adding_a_mailing_list_user">Adding a mailing list user</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_a_mailing_list_user_22"><a href="#deleting_a_mailing_list_user">Deleting a mailing list user</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_mailing_list_users_22"><a href="#listing_mailing_list_users">Listing mailing list users</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_a_domain_22"><a href="#adding_a_domain">Adding a domain</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_a_domain_22"><a href="#deleting_a_domain">Deleting a domain</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_handled_domains_22"><a href="#listing_handled_domains">Listing handled domains</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_a_domain_alias_22"><a href="#adding_a_domain_alias">Adding a domain alias</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_a_domain_alias_22"><a href="#deleting_a_domain_alias">Deleting a domain alias</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_alias_domains_22"><a href="#listing_alias_domains">Listing alias domains</a></a></strong><br />
</dt>
<dt><strong><a name="item__22getting_custom_domain_file_22"><a href="#getting_custom_domain_file">Getting custom domain file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22setting_custom_domain_file_22"><a href="#setting_custom_domain_file">Setting custom domain file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_custom_domains_22"><a href="#listing_custom_domains">Listing custom domains</a></a></strong><br />
</dt>
<dt><strong><a name="item__22adding_a_pop3_external_link_22"><a href="#adding_a_pop3_external_link">Adding a POP3 external link</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_a_pop3_external_link_22"><a href="#deleting_a_pop3_external_link">Deleting a POP3 external link</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_pop3_external_links_22"><a href="#listing_pop3_external_links">Listing POP3 external links</a></a></strong><br />
</dt>
<dt><strong><a name="item__22enabling_a_pop3_external_link_22"><a href="#enabling_a_pop3_external_link">Enabling a POP3 external link</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_files_22"><a href="#listing_files">Listing files</a></a></strong><br />
</dt>
<dt><strong><a name="item__22getting_configuration_file_22"><a href="#getting_configuration_file">Getting configuration file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22setting_configuration_file_22"><a href="#setting_configuration_file">Setting configuration file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22listing_frozen_messages_22"><a href="#listing_frozen_messages">Listing frozen messages</a></a></strong><br />
</dt>
<dt><strong><a name="item__22rescheduling_frozen_message_22"><a href="#rescheduling_frozen_message">Rescheduling frozen message</a></a></strong><br />
</dt>
<dt><strong><a name="item__22deleting_frozen_message_22"><a href="#deleting_frozen_message">Deleting frozen message</a></a></strong><br />
</dt>
<dt><strong><a name="item__22getting_frozen_message_log_file_22"><a href="#getting_frozen_message_log_file">Getting frozen message log file</a></a></strong><br />
</dt>
<dt><strong><a name="item__22getting_frozen_message_22"><a href="#getting_frozen_message">Getting frozen message</a></a></strong><br />
</dt>
<dt><strong><a name="item__22starting_a_queue_flush_22"><a href="#starting_a_queue_flush">Starting a queue flush</a></a></strong><br />
</dt>
<dt><strong><a name="item__22do_nothing_command_22"><a href="#do_nothing_command">Do nothing command</a></a></strong><br />
</dt>
<dt><strong><a name="item__22quit_the_connection_22"><a href="#quit_the_connection">Quit the connection</a></a></strong><br />
</dt>
<dt><strong><a name="item__22do_you_want_2e_2e_2e_3f_22"><a href="#do_you_want___">Do you want...?</a></a></strong><br />
</dt>
</dl>
<p>
</p>
<h2><a name="description">Description</a></h2>
<p>The XMail admin server 'speaks' a given protocol that can be used by external GUI
utilities written with the more disparate scripting languages, to remote administer
the mail server.
The protocol is based on sending formatted command and waiting for formatted
server responses and error codes.
All the lines, commands, and responses are delimited by a &lt;CR&gt;&lt;LF&gt; pair.
The error code string (I'll call it RESSTRING) has the given format:</p>
<pre>
 &quot;+DDDDD OK&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>if the command execution is successful while:</p>
<pre>
 &quot;-DDDDD ErrorString&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>if the command failed.</p>
<p>The `` character is not included in responses.
DDDDD is a numeric error code while ErrorString is a description of the error.
If DDDDD equals  00100, a lines list, terminated by a line with a single point
(&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;), follows the response.</p>
<p>The input format for commands is similar to the one used in TAB files:</p>
<pre>
 &quot;cmdstring&quot;[TAB]&quot;param1&quot;[TAB]...&quot;paramN&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where 'cmdstring' is the command string identifying the action to be performed,
and param1,... are the parameters of the command.</p>
<p>Immediately after the connection with XMail controller server is established
the client receives a RESSTRING that is:</p>
<pre>
 +00000 &lt;TimeStamp&gt; XMail ...</pre>
<p>if the server is ready, while:</p>
<pre>
 -DDDDD ...</pre>
<p>(where DDDDDD is an error code) if not.</p>
<p>The  TimeStamp  string has the format:</p>
<pre>
 currtime.pid@ipaddress</pre>
<p>and is used in MD5 authentication procedure.</p>
<p>As the first action immediately after the connection the client must send an
authentication string with this format:</p>
<pre>
 &quot;user&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where user must be enabled to remote admin XMail. Clear text
authentication should not be used due server security.
Using MD5 authentication instead, the client must perform an MD5 checksum on the
string composed by (&lt;&gt; included):</p>
<pre>
 &lt;TimeStamp&gt;password</pre>
<p>and then send to the server:</p>
<pre>
 &quot;user&quot;[TAB]&quot;#md5chksum&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where  md5chksum  is the MD5 checksum (note '<strong>#</strong>' as first char of sent digest).
The result of the authentication send is a RESSTRING.
If the user does not receive a positive authentication response, the connection is
closed by the server.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_a_user">Adding a user</a></h2>
<pre>
 &quot;useradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;usertype&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_domain">domain</a></strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong><a name="item_username">username</a></strong><br />
</dt>
<dd>
username to add.
</dd>
<p></p>
<dt><strong><a name="item_password">password</a></strong><br />
</dt>
<dd>
user password.
</dd>
<p></p>
<dt><strong><a name="item_usertype">usertype</a></strong><br />
</dt>
<dd>
'U' for normal user and 'M' for mailing list.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_a_user">Deleting a user</a></h2>
<pre>

 &quot;userdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username to delete.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="changing_a_user_s_password">Changing a user's password</a></h2>
<pre>
 &quot;userpasswd&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username (must exist).
</dd>
<p></p>
<dt><strong>password</strong><br />
</dt>
<dd>
new password.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="authenticate_user">Authenticate user</a></h2>
<pre>
 &quot;userauth&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username.
</dd>
<p></p>
<dt><strong>password</strong><br />
</dt>
<dd>
password.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="retrieve_user_statistics">Retrieve user statistics</a></h2>
<pre>
 &quot;userstat&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username/alias.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.
If successful (00100), a formatted matching users list follows terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
This is the format of the listing:</p>
<pre>
 &quot;variable&quot;[TAB]&quot;value&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>Where valid variables are:</p>
<dl>
<dt><strong><a name="item_realaddress">RealAddress</a></strong><br />
</dt>
<dd>
real address (maybe different is the supplied username is an alias).
</dd>
<p></p>
<dt><strong><a name="item_mailboxsize">MailboxSize</a></strong><br />
</dt>
<dd>
total size of the mailbox in bytes.
</dd>
<p></p>
<dt><strong><a name="item_mailboxmessages">MailboxMessages</a></strong><br />
</dt>
<dd>
total number of messages.
</dd>
<p></p>
<dt><strong><a name="item_lastloginip">LastLoginIP</a></strong><br />
</dt>
<dd>
last user login IP address.
</dd>
<p></p>
<dt><strong><a name="item_lastlogintimedate">LastLoginTimeDate</a></strong><br />
</dt>
<dd>
time of the last login.
</dd>
<p></p></dl>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_an_alias">Adding an alias</a></h2>
<pre>
 &quot;aliasadd&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;account&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong><a name="item_alias">alias</a></strong><br />
</dt>
<dd>
alias to add.
</dd>
<p></p>
<dt><strong><a name="item_account">account</a></strong><br />
</dt>
<dd>
real email account (locally handled). This can be a fully qualified email address
or a username inside the same domain.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_an_alias">Deleting an alias</a></h2>
<pre>
 &quot;aliasdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>alias</strong><br />
</dt>
<dd>
alias to delete.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_aliases">Listing aliases</a></h2>
<pre>
 &quot;aliaslist&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;account&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;aliaslist&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;aliaslist&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;aliaslist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name, optional (can contain wild cards).
</dd>
<p></p>
<dt><strong>alias</strong><br />
</dt>
<dd>
alias name, optional (can contain wildcards).
</dd>
<p></p>
<dt><strong>account</strong><br />
</dt>
<dd>
account, optional (can contain wildcards).
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;aliaslist&quot;[TAB]&quot;foo.bar&quot;[TAB]&quot;*&quot;[TAB]&quot;mickey&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>lists all aliases of user '<strong>mickey</strong>' in domain '<strong>foo.bar</strong>'.</p>
<p>The result is a RESSTRING.
In successful cases (00100) a formatted matching users list follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
This is the format of the listing:</p>
<pre>
 &quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_an_external_alias">Adding an external alias</a></h2>
<pre>
 &quot;exaliasadd&quot;[TAB]&quot;local-address&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_local_2daddress">local-address</a></strong><br />
</dt>
<dd>
local email address.
</dd>
<p></p>
<dt><strong><a name="item_remote_2daddress">remote-address</a></strong><br />
</dt>
<dd>
remote email address.
</dd>
<p></p></dl>
<p>For example, the following command string:</p>
<pre>
 &quot;exaliasadd&quot;[TAB]&quot;dlibenzi@home.bogus&quot;[TAB]&quot;dlibenzi@xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>will link the external email address '<strong>dlibenzi&#64;xmailserver.org</strong>' with the
local email address '<strong>dlibenzi&#64;home.bogus</strong>'. The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_an_external_alias">Deleting an external alias</a></h2>
<pre>
 &quot;exaliasdel&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>remote-address</strong><br />
</dt>
<dd>
remote email address.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_external_aliases">Listing external aliases</a></h2>
<pre>
 &quot;exaliaslist&quot;[TAB]&quot;local-address&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;exaliaslist&quot;[TAB]&quot;local-address&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;exaliaslist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>local-address</strong><br />
</dt>
<dd>
local email address. This can contain wildcard characters.
</dd>
<p></p>
<dt><strong>remote-address</strong><br />
</dt>
<dd>
remote email address. This can contain wildcard characters.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;exaliaslist&quot;[TAB]&quot;*@home.bogus&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>lists all the external aliases linked to local accounts in domain '<strong>home.bogus</strong>'.</p>
<p>The result is a RESSTRING.
In successful cases (00100) a formatted matching users list follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
This is the format of the listing:</p>
<pre>
 &quot;rmt-domain&quot;[TAB]&quot;rmt-name&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-name&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_user_vars">Listing user vars</a></h2>
<pre>
 &quot;uservars&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.
In successfully cases (00100) a formatted list of user vars follow, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
This is the format of the listing:</p>
<pre>
 &quot;varname&quot;[TAB]&quot;varvalue&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="setting_user_vars">Setting user vars</a></h2>
<pre>
 &quot;uservarsset&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;varname&quot;[TAB]&quot;varvalue&quot; ... &lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username.
</dd>
<p></p>
<dt><strong><a name="item_varname">varname</a></strong><br />
</dt>
<dd>
variable name.
</dd>
<p></p>
<dt><strong><a name="item_varvalue">varvalue</a></strong><br />
</dt>
<dd>
variable value.
</dd>
<p></p></dl>
<p>There can be multiple variable assignments with a single call.
If '<strong>varvalue</strong>' is the string '<strong>.|rm</strong>' the variable '<strong>varname</strong>' is deleted.
The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_users">Listing users</a></h2>
<pre>
 &quot;userlist&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;userlist&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;userlist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name, optional (can contain wild cards).
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username, optional (can contain wild cards).
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;userlist&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;*admin&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>lists all users of domain '<strong>spacejam.foo</strong>' that end with the word '<strong>admin</strong>'.</p>
<p>The result are a RESSTRING.
If successful (00100), a formatted matching users list follows terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
This is the format of the listing:</p>
<pre>
 &quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;usertype&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="getting_mailproc_tab_file">Getting mailproc.tab file</a></h2>
<pre>
 &quot;usergetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;usergetmproc&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;admin&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>gets mailproc.tab file for user '<strong>admin</strong>' in domain '<strong>spacejam.foo</strong>'.</p>
<p>The result is a RESSTRING.
In successful cases (00100) the mailproc.tab file is listed line by line, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="setting_mailproc_tab_file">Setting mailproc.tab file</a></h2>
<pre>
 &quot;usersetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p>
<dt><strong>username</strong><br />
</dt>
<dd>
username.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;usersetmproc&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;admin&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>sets mailproc.tab file for user '<strong>admin</strong>' in domain '<strong>spacejam.foo</strong>'.</p>
<p>The result is a RESSTRING.
If successful (00101), the client must list the mailproc.tab file line by line,
ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
If a line of the file begins with a dot, another dot must be added at the beginning of the line.
If the file has zero length the mailproc.tab is deleted.
The client then gets another RESSTRING indicating the final command result.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_a_mailing_list_user">Adding a mailing list user</a></h2>
<pre>
 &quot;mluseradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;[TAB]&quot;perms&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;mluseradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong><a name="item_mlusername">mlusername</a></strong><br />
</dt>
<dd>
mailing list username.
</dd>
<p></p>
<dt><strong><a name="item_mailaddress">mailaddress</a></strong><br />
</dt>
<dd>
mail address to add to the mailing list 'mlusername&#64;domain'.
</dd>
<p></p>
<dt><strong>perms</strong><br />
</dt>
<dd>
user permissions (R or RW or RA).
When '<strong>perms</strong>' is not specified the default is RW.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_a_mailing_list_user">Deleting a mailing list user</a></h2>
<pre>
 &quot;mluserdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>mlusername</strong><br />
</dt>
<dd>
mailing list username.
</dd>
<p></p>
<dt><strong>mailaddress</strong><br />
</dt>
<dd>
mail address to delete from the mailing list 'mlusername&#64;domain'.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_mailing_list_users">Listing mailing list users</a></h2>
<pre>
 &quot;mluserlist&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>mlusername</strong><br />
</dt>
<dd>
mailing list username.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.
If successful (00100), a formatted list of mailing list users follows terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_a_domain">Adding a domain</a></h2>
<pre>
 &quot;domainadd&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name to add.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_a_domain">Deleting a domain</a></h2>
<pre>
 &quot;domaindel&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name to delete.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.
This is not always a safe operation.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_handled_domains">Listing handled domains</a></h2>
<pre>
 &quot;domainlist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or:</p>
<pre>
 &quot;domainlist&quot;[TAB]&quot;wildmatch0&quot;[TAB]...[TAB]&quot;wildmatchN&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
The wild match versions simply returns a filtered list of domains.
If successful (00100), a formatted list of handled domains follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_a_domain_alias">Adding a domain alias</a></h2>
<pre>
 &quot;aliasdomainadd&quot;[TAB]&quot;realdomain&quot;[TAB]&quot;aliasdomain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>Example:</p>
<pre>
 &quot;aliasdomainadd&quot;[TAB]&quot;xmailserver.org&quot;[TAB]&quot;xmailserver.com&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>defines '<strong>xmailserver.com</strong>' as an alias of '<strong>xmailserver.org</strong>', or:</p>
<pre>
 &quot;aliasdomainadd&quot;[TAB]&quot;xmailserver.org&quot;[TAB]&quot;*.xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>defines all subdomains of '<strong>xmailserver.org</strong>' as alises of '<strong>xmailserver.org</strong>'.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_a_domain_alias">Deleting a domain alias</a></h2>
<pre>
 &quot;aliasdomaindel&quot;[TAB]&quot;aliasdomain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>Example:</p>
<pre>
 &quot;aliasdomaindel&quot;[TAB]&quot;*.xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>removes the '<strong>*.xmailserver.org</strong>' domain alias.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_alias_domains">Listing alias domains</a></h2>
<pre>
 &quot;aliasdomainlist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or:</p>
<pre>
 &quot;aliasdomainlist&quot;[TAB]&quot;wild-dom-match&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or:</p>
<pre>
 &quot;aliasdomainlist&quot;[TAB]&quot;wild-dom-match&quot;[TAB]&quot;wild-adom-match&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
The wild match version simply returns a filtered list of alias domains.
If successful (00100), a formatted list of alias domains follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The output format is:</p>
<pre>
 &quot;real-domain&quot;[TAB]&quot;alias-domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="getting_custom_domain_file">Getting custom domain file</a></h2>
<pre>
 &quot;custdomget&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;custdomget&quot;[TAB]&quot;spacejam.foo&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>gets the custom domain file for domain '<strong>spacejam.foo</strong>'.</p>
<p>The result is a RESSTRING.
If successful (00100), the custom domain file is listed line by line terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="setting_custom_domain_file">Setting custom domain file</a></h2>
<pre>
 &quot;custdomset&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>domain</strong><br />
</dt>
<dd>
domain name.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;custdomset&quot;[TAB]&quot;spacejam.foo&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>sets custom domain file for domain '<strong>spacejam.foo</strong>'.</p>
<p>The result is a RESSTRING.
If successful (00101), the client must list the custom domain file line by line,
ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
If a line of the file begins with a dot, another dot must be added at the begin of the line.
If the file has zero length the custom domain file is deleted.
The client then gets another RESSTRING indicating the final command result.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_custom_domains">Listing custom domains</a></h2>
<pre>
 &quot;custdomlist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
If successful (00100), a formatted list of custom domains follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="adding_a_pop3_external_link">Adding a POP3 external link</a></h2>
<pre>
 &quot;poplnkadd&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;=&gt;
   [TAB]&quot;extrn-username&quot;[TAB]&quot;extrn-password&quot;[TAB]&quot;authtype&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_loc_2ddomain">loc-domain</a></strong><br />
</dt>
<dd>
local domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong><a name="item_loc_2dusername">loc-username</a></strong><br />
</dt>
<dd>
local username which receives mails.
</dd>
<p></p>
<dt><strong><a name="item_extrn_2ddomain">extrn-domain</a></strong><br />
</dt>
<dd>
external domain.
</dd>
<p></p>
<dt><strong><a name="item_extrn_2dusername">extrn-username</a></strong><br />
</dt>
<dd>
external username.
</dd>
<p></p>
<dt><strong><a name="item_extrn_2dpassword">extrn-password</a></strong><br />
</dt>
<dd>
external user password.
</dd>
<p></p>
<dt><strong><a name="item_authtype">authtype</a></strong><br />
</dt>
<dd>
authentication method ('<strong>CLR</strong>' = USER/PASS auth '<strong>APOP</strong>' = APOP auth).
</dd>
<p></p></dl>
<p>The remote server must support '<strong>APOP</strong>' authentication to specify APOP as authtype.
Using APOP authentication is more secure because clear usernames and passwords do not
travel on the network; if you're not sure about it, specify '<strong>CLR</strong>' as authtype.</p>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_a_pop3_external_link">Deleting a POP3 external link</a></h2>
<pre>
 &quot;poplnkdel&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;=&gt;
   [TAB]&quot;extrn-username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>loc-domain</strong><br />
</dt>
<dd>
local domain name (must be handled by the server).
</dd>
<p></p>
<dt><strong>loc-username</strong><br />
</dt>
<dd>
local username which receives mails.
</dd>
<p></p>
<dt><strong>extrn-domain</strong><br />
</dt>
<dd>
external domain.
</dd>
<p></p>
<dt><strong>extrn-username</strong><br />
</dt>
<dd>
external username.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_pop3_external_links">Listing POP3 external links</a></h2>
<pre>
 &quot;poplnklist&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;poplnklist&quot;[TAB]&quot;loc-domain&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;poplnklist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
If successful (00100), a formatted list of handled domains follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
The format of the listing is:</p>
<pre>
 &quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;[TAB]&quot;extrn-username&quot;=&gt;
   [TAB]&quot;extrn-password&quot;[TAB]&quot;authtype&quot;[TAB]&quot;on-off&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="enabling_a_pop3_external_link">Enabling a POP3 external link</a></h2>
<pre>
 &quot;poplnkenable&quot;[TAB]&quot;enable&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;=&gt;
   [TAB]&quot;extrn-domain&quot;[TAB]&quot;extrn-username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>or</p>
<pre>
 &quot;poplnkenable&quot;[TAB]&quot;enable&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_enable">enable</a></strong><br />
</dt>
<dd>
1 for enabling - 0 for disabling.
</dd>
<p></p>
<dt><strong>loc-domain</strong><br />
</dt>
<dd>
local domain name.
</dd>
<p></p>
<dt><strong>loc-username</strong><br />
</dt>
<dd>
local username which receives mails.
</dd>
<p></p>
<dt><strong>extrn-domain</strong><br />
</dt>
<dd>
external domain.
</dd>
<p></p>
<dt><strong>extrn-username</strong><br />
</dt>
<dd>
external username.
</dd>
<p></p></dl>
<p>In the second format all users, links are affected by the enable operation.</p>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_files">Listing files</a></h2>
<pre>
 &quot;filelist&quot;[TAB]&quot;relative-dir-path&quot;[TAB]&quot;match-string&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_relative_2ddir_2dpath">relative-dir-path</a></strong><br />
</dt>
<dd>
path relative to MAIL_ROOT path.
</dd>
<p></p>
<dt><strong><a name="item_match_2dstring">match-string</a></strong><br />
</dt>
<dd>
wild card match string for file list selection.
</dd>
<p></p></dl>
<p>The result is a RESSTRING.
If successful (00100), the directory is listed line by line, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The listing format is:</p>
<p>``filename''[TAB]``filesize''&lt;CR&gt;&lt;LF&gt;</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="getting_configuration_file">Getting configuration file</a></h2>
<pre>
 &quot;cfgfileget&quot;[TAB]&quot;relative-file-path&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_relative_2dfile_2dpath">relative-file-path</a></strong><br />
</dt>
<dd>
path relative to MAIL_ROOT path.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;cfgfileget&quot;[TAB]&quot;ctrlaccounts.tab&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
If successful (00100), the file is listed line by line, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
You CANNOT use this command with indexed files !</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="setting_configuration_file">Setting configuration file</a></h2>
<pre>
 &quot;cfgfileset&quot;[TAB]&quot;relative-file-path&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>relative-file-path</strong><br />
</dt>
<dd>
path relative to MAIL_ROOT path.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;cfgfileset&quot;[TAB]&quot;ctrlaccounts.tab&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
IF successful (00101), the client must list the configuration file line by line,
ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
If a line of the file begins with a dot, another dot must be added at the beginning of the line.
If the file has zero length the configuration file is deleted.
The client then gets another RESSTRING indicating the final command result.
Remember that configuration files have a strict syntax and that pushing a incorrect one
can make XMail not work properly.
You CANNOT use this command with indexed files!</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="listing_frozen_messages">Listing frozen messages</a></h2>
<pre>
 &quot;frozlist&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.
If successful (00100), a formatted list of frozen messages follows, terminated by a line
containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).
The format of the listing is:</p>
<pre>
 &quot;msgfile&quot;[tab]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;from&quot;[TAB]&quot;to&quot;[TAB]&quot;time&quot;[TAB]&quot;size&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>Where:</p>
<dl>
<dt><strong><a name="item_msgfile">msgfile</a></strong><br />
</dt>
<dd>
message name or id.
</dd>
<p></p>
<dt><strong><a name="item_lev0">lev0</a></strong><br />
</dt>
<dd>
queue fs level 0 (first level directory index).
</dd>
<p></p>
<dt><strong><a name="item_lev1">lev1</a></strong><br />
</dt>
<dd>
queue fs level 1 (second level directory index).
</dd>
<p></p>
<dt><strong><a name="item_from">from</a></strong><br />
</dt>
<dd>
message sender.
</dd>
<p></p>
<dt><strong><a name="item_to">to</a></strong><br />
</dt>
<dd>
message destination.
</dd>
<p></p>
<dt><strong><a name="item_time">time</a></strong><br />
</dt>
<dd>
message time (``YYYY-MM-DD HH:MM:SS'').
</dd>
<p></p>
<dt><strong><a name="item_size">size</a></strong><br />
</dt>
<dd>
message size in bytes.
</dd>
<p></p></dl>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="rescheduling_frozen_message">Rescheduling frozen message</a></h2>
<pre>
 &quot;frozsubmit&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>msgfile</strong><br />
</dt>
<dd>
message name or id.
</dd>
<p></p>
<dt><strong>lev0</strong><br />
</dt>
<dd>
queue fs level 0 (first level directory index).
</dd>
<p></p>
<dt><strong>lev1</strong><br />
</dt>
<dd>
queue fs level 1 (second level directory index).
</dd>
<p></p></dl>
<p>You can get this information from the <a href="#listing_frozen_messages">frozlist</a> command.
After a message has been successfully rescheduled it is deleted from the frozen fs path.
The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="deleting_frozen_message">Deleting frozen message</a></h2>
<pre>
 &quot;frozdel&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>msgfile</strong><br />
</dt>
<dd>
message name or id.
</dd>
<p></p>
<dt><strong>lev0</strong><br />
</dt>
<dd>
queue fs level 0 (first level directory index).
</dd>
<p></p>
<dt><strong>lev1</strong><br />
</dt>
<dd>
queue fs level 1 (second level directory index).
</dd>
<p></p></dl>
<p>You can get this information from the <a href="#listing_frozen_messages">frozlist</a> command.
The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="getting_frozen_message_log_file">Getting frozen message log file</a></h2>
<pre>
 &quot;frozgetlog&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>msgfile</strong><br />
</dt>
<dd>
message name or id.
</dd>
<p></p>
<dt><strong>lev0</strong><br />
</dt>
<dd>
queue fs level 0 (first level directory index).
</dd>
<p></p>
<dt><strong>lev1</strong><br />
</dt>
<dd>
queue fs level 1 (second level directory index).
</dd>
<p></p></dl>
<p>You can get this information from the <a href="#listing_frozen_messages">frozlist</a> command.
The result is a RESSTRING.
If successful (00100), the frozen message log file follows,
terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="getting_frozen_message">Getting frozen message</a></h2>
<pre>
 &quot;frozgetmsg&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong>msgfile</strong><br />
</dt>
<dd>
message name or id.
</dd>
<p></p>
<dt><strong>lev0</strong><br />
</dt>
<dd>
queue fs level 0 (first level directory index).
</dd>
<p></p>
<dt><strong>lev1</strong><br />
</dt>
<dd>
queue fs level 1 (second level directory index).
</dd>
<p></p></dl>
<p>You can get this information from the <a href="#listing_frozen_messages">frozlist</a> command.
The result is a RESSTRING.
If successful (00100), the frozen message file follows,
terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="starting_a_queue_flush">Starting a queue flush</a></h2>
<pre>
 &quot;etrn&quot;[TAB]&quot;email-match0&quot;...&lt;CR&gt;&lt;LF&gt;</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_email_2dmatch0">email-match0</a></strong><br />
</dt>
<dd>
wild card email matching for destination address.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 &quot;etrn&quot;  &quot;*@*.mydomain.com&quot;  &quot;your-domain.org&quot;</pre>
<p>starts queueing all messages with a matching destination address.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="do_nothing_command">Do nothing command</a></h2>
<p>``noop''&lt;CR&gt;&lt;LF&gt;</p>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="quit_the_connection">Quit the connection</a></h2>
<pre>
 &quot;quit&quot;&lt;CR&gt;&lt;LF&gt;</pre>
<p>The result is a RESSTRING.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<h2><a name="do_you_want___">Do you want...?</a></h2>
<p>Do you want to build GUI configuration tools using common scripting
languages (Java, TCL/Tk, etc) and XMail controller protocol?
Do you want to build Web configuration tools?
Please let me know &lt;<a href="mailto:davidel@xmailserver.org">davidel@xmailserver.org</a>&gt;.</p>
<p>[<a href="#xmail_admin_protocol">admin protocol</a>] [<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="xmail_local_mailer">XMAIL LOCAL MAILER</a></h1>
<p>XMail has the ability to deliver locally prepared mail files that if finds
in the '<strong>spool/local</strong>' directory.
The format of these files is strict:</p>
<pre>
 mail from:&lt;...&gt;[CR][LF]
 rcpt to:&lt;...&gt;[CR][LF]
 ...
 [CR][LF]
 message text in RFC822 format with [CR][LF] line termination</pre>
<p>All lines must be [CR][LF] terminated, with one mail-from statement, one or more
rcpt-to statements, an empty line and the message text.
Mail files must not be created directly inside the '<strong>/spool/local</strong>' directory but
instead inside '<strong>/spool/temp</strong>' directory.
When the file is prepared it has to be moved into '<strong>/spool/local</strong>'.
The file name format is:</p>
<pre>
 stime-seqnr.pid.hostname</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item_stime">stime</a></strong><br />
</dt>
<dd>
system time in sec from 01/01/1970.
</dd>
<p></p>
<dt><strong><a name="item_seqnr">seqnr</a></strong><br />
</dt>
<dd>
sequence number for the current file.
</dd>
<p></p>
<dt><strong><a name="item_pid">pid</a></strong><br />
</dt>
<dd>
process or thread id.
</dd>
<p></p>
<dt><strong><a name="item_hostname">hostname</a></strong><br />
</dt>
<dd>
creator process host name.
</dd>
<p></p></dl>
<p>Example:</p>
<pre>
 97456928-001.7892.home.bogus</pre>
<p>XMail has a number of LMAIL threads that periodically scan the '<strong>/spool/local</strong>'
directory watching for locally generated mail files.
You can tune this number of threads with the '<strong>-Ln nthreads</strong>' command line option.
The suggested number ranges from three to seven.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="ctrlclnt__xmail_administration_">CtrlClnt (XMAIL ADMINISTRATION)</a></h1>
<p>You can use CtrlClnt to send administration commands to XMail.
These commands are defined in the previous section (<a href="#xmail_admin_protocol">XMAIL ADMIN PROTOCOL</a>).
The syntax of CtrlClnt is:</p>
<pre>
 CtrlClnt  [-snuptf]  ...</pre>
<p>where:</p>
<dl>
<dt><strong><a name="item__2ds_server">-s server</a></strong><br />
</dt>
<dd>
set server address.
</dd>
<p></p>
<dt><strong><a name="item__2dn_port">-n port</a></strong><br />
</dt>
<dd>
set server port [6017].
</dd>
<p></p>
<dt><strong><a name="item__2du_user">-u user</a></strong><br />
</dt>
<dd>
set username.
</dd>
<p></p>
<dt><strong><a name="item__2dp_pass">-p pass</a></strong><br />
</dt>
<dd>
set password.
</dd>
<p></p>
<dt><strong><a name="item__2dt_timeout">-t timeout</a></strong><br />
</dt>
<dd>
set timeout [60].
</dd>
<p></p>
<dt><strong><a name="item__2df_filename">-f filename</a></strong><br />
</dt>
<dd>
set dump filename [stdout].
</dd>
<p></p></dl>
<p>With the command and parameters that follow adhering to the command syntax, ie:</p>
<pre>
 CtrlClnt  -s mail.foo.org -u davide.libenzi -p ciao=&gt;
   useradd home.bogus foouser foopasswd U</pre>
<p>executes the command  useradd  with parameters '<strong>home.bogus foouser foopasswd U</strong>'.</p>
<p>CtrlClnt returns 0 if the command is successful and != 0 if not.
If the command is a query, then the result is printed to  stdout.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="server_shutdown">SERVER SHUTDOWN</a></h1>
<dl>
<dt><strong><a name="item__5blinux_5d">[Linux]</a></strong><br />
</dt>
<dd>
Under Linux, XMail creates a file named XMail.pid in '<strong>/var/run</strong>' that contains the PID
of the main XMail thread.
By issuing a:
</dd>
<dd>
<pre>
 kill -INT `cat /var/run/XMail.pid`</pre>
</dd>
<dd>
<p>a system administrator can initiate the shutdown process (this can take several seconds).
You can use the supplied '<strong>xmail</strong>' startup script to start / stop / restart XMail:</p>
</dd>
<dd>
<pre>
 xmail start / stop / restart</pre>
</dd>
<p></p>
<dt><strong><a name="item__5bnt_as_console_service_5d">[NT as console service]</a></strong><br />
</dt>
<dd>
Under NT console service (XMail --debug ...) you can hit Ctrl-C to initiate the
shutdown process.
</dd>
<p></p>
<dt><strong><a name="item__5bnt_as_service_5d">[NT as service]</a></strong><br />
</dt>
<dd>
Using [Control Panel]-&gt;[Services] you can start and stop XMail as you wish.
</dd>
<p></p>
<dt><strong><a name="item__5ball_5d">[All]</a></strong><br />
</dt>
<dd>
XMail detects a shutdown condition by checking the presence of a file named
'<strong>.shutdown</strong>' in its main directory (MAIL_ROOT).
You can initiate XMail shutdown process by creating (or copying) a file
with that name into MAIL_ROOT.
</dd>
<p></p></dl>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="mkusers">MkUsers</a></h1>
<p>This command line utility enables you to create the user accounts structure by giving
it a formatted list of users parameters (or a formatted text file).
The syntax of the list (or file) is:</p>
<pre>
 domain;username;password;real-name;homepage[NEWLINE]</pre>
<p>where a line whose first character is '<strong>#</strong>' is treated as a comment.
This utility can also be used to create a random number users (useful for me
to test server performance).</p>
<p>These are MkUsers command line parameters:</p>
<dl>
<dt><strong><a name="item__2da_numusers">-a numusers</a></strong><br />
</dt>
<dd>
number of users to create in auto-mode.
</dd>
<p></p>
<dt><strong><a name="item__2dd_domain">-d domain</a></strong><br />
</dt>
<dd>
domain name in auto-mode.
</dd>
<p></p>
<dt><strong><a name="item__2df_inputfile">-f inputFile</a></strong><br />
</dt>
<dd>
input file name {stdin}.
</dd>
<p></p>
<dt><strong><a name="item__2du_username">-u username</a></strong><br />
</dt>
<dd>
radix user name in auto-mode.
</dd>
<p></p>
<dt><strong><a name="item__2dr_rootdir">-r rootdir</a></strong><br />
</dt>
<dd>
mail root path {./}.
</dd>
<p></p>
<dt><strong><a name="item__2ds_mboxsize">-s mboxsize</a></strong><br />
</dt>
<dd>
mailbox maximum size {10000}.
</dd>
<p></p>
<dt><strong><a name="item__2di_useridbase">-i useridbase</a></strong><br />
</dt>
<dd>
base user id {1};
</dd>
<p></p>
<dt><strong><a name="item__2dm">-m</a></strong><br />
</dt>
<dd>
create Maildir boxes.
</dd>
<p></p>
<dt><strong><a name="item__2dh">-h</a></strong><br />
</dt>
<dd>
show this message.
</dd>
<p></p></dl>
<p>MkUsers creates, under the specified root directory, the given structure:</p>
<pre>
 rootdir            &lt;dir&gt;
   mailusers.tab    &lt;file&gt;
   domains          &lt;dir&gt;
     domainXXX      &lt;dir&gt;
       userXXX      &lt;dir&gt;
         user.tab   &lt;file&gt;
         mailbox    &lt;dir&gt;
       ...
    ...</pre>
<p>for the mailbox structure, while:</p>
<pre>
 rootdir            &lt;dir&gt;
   mailusers.tab    &lt;file&gt;
   domains          &lt;dir&gt;
     domainXXX      &lt;dir&gt;
       userXXX      &lt;dir&gt;
         user.tab   &lt;file&gt;
         Maildir    &lt;dir&gt;
           tmp      &lt;dir&gt;
           new      &lt;dir&gt;
           cur      &lt;dir&gt;
       ...
     ...</pre>
<p>for the Maildir structure.</p>
<p>If the file '<strong>mailusers.tab</strong>' already exist in the mail root path, MkUsers exits without
overwriting the existing copy.
This protect you from accidentally overwriting your file when playing inside
the real MAIL_ROOT directory.
If you want to setup the root directory (-r ...) as MAIL_ROOT, you must delete
by hand the existing file (you must know what you're doing).
If you setup the root directory (-r ...) as MAIL_ROOT you MUST have XMail stopped
before running MkUsers.
Existing files and directories are not overwritten by MkUsers so you can keep
your users db in the formatted text file (or generate it by a database dump for example)
and run MkUsers to create the structure.
Remember that you have to add new domains in the '<strong>domains.tab</strong>' file by hand.
MkUsers is intended as a bulk-mode utility, not to create single user; for this
CtrlClnt (or other GUI/Web configuration utilities) is better suited.</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="sendmail">sendmail</a></h1>
<p>When building XMail, an executable called '<strong>sendmail</strong>' is created.
This is a replacement of the sendmail program used mostly on Unix systems;
it uses the local mail delivery
of XMail to send email generated onto the server machine.
These sendmail options are supported (other options are simply ignored):</p>
<dl>
<dt><strong><a name="item__2df_7bmail_from_7d">-f{mail from}</a></strong><br />
</dt>
<dd>
Set the sender of the email.
</dd>
<p></p>
<dt><strong><a name="item__2df_7bext_mail_from_7d">-F{ext mail from}</a></strong><br />
</dt>
<dd>
Set the extended sender of the email.
</dd>
<p></p>
<dt><strong><a name="item__2dt">-t</a></strong><br />
</dt>
<dd>
Extract recipients from the 'To:'/'Cc:'/'Bcc:' header tags.
</dd>
<p></p></dl>
<p>The syntax is:</p>
<pre>
 sendmail [-t] [-f...] [-F...] [--input-file fname] [--xinput-file fname]=&gt;
   [--rcpt-file fname] [--] recipient ...</pre>
<p>The message content is read from the standard input and must be RFC compliant.</p>
<p>The following parameters are XMail extensions meant to be used with mailing lists managers (using
sendmail as a mail list exploder):</p>
<dl>
<dt><strong><a name="item__2d_2dinput_2dfile_fname">--input-file fname</a></strong><br />
</dt>
<dd>
take the message from the specified file instead from stdin (RFC format).
</dd>
<p></p>
<dt><strong><a name="item__2d_2dxinput_2dfile_fname">--xinput-file fname</a></strong><br />
</dt>
<dd>
take the message from the specified file instead from stdin (XMail format).
</dd>
<p></p>
<dt><strong><a name="item__2d_2drcpt_2dfile_fname">--rcpt-file fname</a></strong><br />
</dt>
<dd>
add recipients listed inside the specified file (list exploder).
</dd>
<p></p></dl>
<p>To be RFC compliant means that the message MUST have the format:</p>
<pre>
 [Headers]
 NewLine
 Body</pre>
<p>Suppose you have your message in the file 'msg.txt', you're 'xmailuser&#64;smartdomain', and
you want to send the message to 'user1&#64;dom1' and 'user2&#64;dom2'. The syntax is:</p>
<pre>
 sendmail -fxmailuser@smartdomain user1@dom1 user2@dom2 &lt; msg.txt</pre>
<p>or</p>
<pre>
 sendmail -fxmailuser@smartdomain --input-file msg.txt user1@dom1 user2@dom2</pre>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="miscellaneous">MISCELLANEOUS</a></h1>
<ol>
<li></li>
To handle multiple POP3 domains, the server makes a reverse lookup of the IP address
upon which it receives the connection.
Suppose the reverse lookup results in '<strong>xxxx.yyyy.zzzz</strong>'. XMail checks if
'<strong>xxxx.yyyy.zzzz</strong>' is handled, then it checks '<strong>yyyy.zzzz</strong>',  and then '<strong>zzzz</strong>'.
The first resolved (in the given order) is the POP3 domain.
To avoid the above behavior, it's sufficient that the POP3 client supply the entire
email address as POP3 login username:
<pre>
 foo@foodomain.net   ==&gt; foo@foodomain.net</pre>
<p>and not:</p>
<pre>
 foo@foodomain.net   ==&gt; foo</pre>
<p>This enables XMail to handle multiple domains in cases where more nic-names are mapped
over a single IP address.</p>
<p>To run finger queries you must specify:</p>
<pre>
 foo@foodomain.net@foodomain.net</pre>
<p>or as general rule:</p>
<pre>
 username@pop3domain@hostname</pre>
<p>You can use the optional configuration variable '<strong>POP3Domain</strong>'
(see <a href="#server_tab_variables">SERVER.TAB VARIABLES</a> above) 
to set the default
domain for POP3 clients connections.
This means that users of '<strong>POP3Domain</strong>' can use only the name part of their email address
as POP3 login, while users of other hosted domains must use their entire email as
POP3 login.</p>
<p></p>
<li></li>
Important!
<ul>
<li></li>
'<strong>REMEMBER TO REMOVE THE EXAMPLE ACCOUNT FROM CTRLACCOUNTS.TAB FILE!</strong>'
<p></p>
<li></li>
Use ctrl.ipmap.tab to restrict CTRL server access.
<p></p>
<li></li>
Use a long password (mixed upper/lower case with digits) for ctrlaccounts.tab.
<p></p></ul>
<li></li>
The main cause of bugs with XMail is due a bad line termination of configuration
files, so check that these files being correctly line terminated for your OS.
Linux uses the standard &lt;CR&gt; while M$ uses &lt;CR&gt;&lt;LF&gt;.
<p></p>
<li></li>
If you get a bind error in Linux,you must comment pop3, smtp and finger entries
in your /etc/inetd.conf.
<p></p>
<li></li>
Remember to compile the file CTRL.IPMAP.TAB to restrict the access to the IPs you
use to remote administer XMail server.
<p></p>
<li></li>
If you have an heavily loaded server remember to setup the best number of XMAIL threads
by specifying the '<strong>-Qn nthreads</strong>' option (you must do some tentatives to find the best
value for your needs).
Also you can limit the number of SMTP, POP3 and CTRL service threads by specifying
the options '<strong>-SX maxthreads</strong>', '<strong>-PX maxthreads</strong>' and '<strong>-CX maxthreads</strong>'.
<p></p>
<li></li>
If you have enabled logging, remember to setup the '<strong>-Mr hours</strong>' option depending on the
traffic you get in your server.
This avoids XMail having to work with very large log files and can improve server performance.
<p></p>
<li></li>
If you are unable to start XMail (even if you followed this document's instructions), check
the MailRoot directory with the one listed above.
More than one unzipper does not restore empty directories by default.
<p></p></ol>
<p>Please report XMail errors and errors in this document.
If you successfully build and run XMail please let me know at <a href="mailto:davidel@xmailserver.org,">davidel@xmailserver.org,</a>
I don't want money ;)</p>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="known_bugs">KNOWN BUGS</a></h1>
<p>Version 0.1 (Alpha-1):</p>
<ol>
<li><strong><a name="item_linux">1-001     Linux   (FIXED)</a></strong><br />
</li>
SMail threads don't wake up upon a release semaphore by SMTP threads.
<p></p>
<li><strong><a name="item_27_2d001_windows">27-001    Windows</a></strong><br />
</li>
Using XMail inside a net that use MS Proxy Server 2.0 cause XMail to fail
in sending UDP packets for DNS MX queries (due to a bug of WS2_32.DLL linked
to MS Proxy 2.0). I don't know if more recent versions of MS Proxy fixes this bug.
To makes XMail work in such environment you can use 'DefaultSMTPGateways' option
in '<strong>SERVER.TAB</strong>' (see <a href="#server_tab_variables">SERVER.TAB VARIABLES</a> above) to use smart SMTP hosts.
Or better still, strip away MS Proxy server and
setup a cheap PC running Linux + IP-Masquerading that cost exactly 0.0 $ and works great.
Or use 'SmartDNSHost' configuration to redirect recursion queries to a DNS smart host
that support TCP and recursion.
<p></p></ol>
<p>[<a href="#__index__">top</a>]</p>
<p>
</p>
<hr />
<h1><a name="thanks">THANKS</a></h1>
<p>My mother Adelisa, for giving me the light.</p>
<p>My cat Grace, for her patience waiting for food while I'm coding.</p>
<p>All of the free source community, for giving me code and knowledge.

</p>
<p>[<a href="#__index__">top</a>]

</p>

</body>

</html>
